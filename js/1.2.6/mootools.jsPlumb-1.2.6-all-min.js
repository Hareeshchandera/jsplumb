(function(){var d=!!!document.createElement("canvas").getContext;var h=function(t,r,s){var q=t[r];if(q==null){q=[];t[r]=q}q.push(s);return q};var g=null;var m=function(q,r){return p.CurrentLibrary.getAttribute(b(q),r)};var f=function(r,s,q){p.CurrentLibrary.setAttribute(b(r),s,q)};var l=function(r,q){p.CurrentLibrary.addClass(b(r),q)};var k=function(r,q){return p.CurrentLibrary.hasClass(b(r),q)};var c=function(r,q){p.CurrentLibrary.removeClass(b(r),q)};var b=function(q){return p.CurrentLibrary.getElementObject(q)};var o=function(q){return p.CurrentLibrary.getOffset(b(q))};var e=function(q){return p.CurrentLibrary.getSize(b(q))};var a=function(){var u={};var z=this;this.overlayPlacements=[];this.paintStyle=null,this.hoverPaintStyle=null;this._over=function(D){var F=o(b(z.canvas));var H=p.CurrentLibrary.getPageXY(D);var A=H[0]-F.left,G=H[1]-F.top;if(A>0&&G>0&&A<z.canvas.width&&G<z.canvas.height){for(var B=0;B<z.overlayPlacements.length;B++){var C=z.overlayPlacements[B];if(C&&(C[0]<=A&&C[1]>=A&&C[2]<=G&&C[3]>=G)){return true}}if(!d){var E=z.canvas.getContext("2d").getImageData(parseInt(A),parseInt(G),1,1);return E.data[0]!=0||E.data[1]!=0||E.data[2]!=0||E.data[3]!=0}else{}}return false};this.bind=function(A,B){h(u,A,B)};this.fireUpdate=function(C,D,A){if(u[C]){for(var B=0;B<u[C].length;B++){try{u[C][B](D,A)}catch(E){_log("jsPlumb: fireUpdate failed for event "+C+" : "+E+"; not fatal.")}}}};this.clearListeners=function(A){if(A){delete u[A]}else{delete u;u={}}};var x=false;var s=false,q=null,v=null,r=false,y=null,t=null;this.mousemove=function(F){var D=p.CurrentLibrary;var C=D.getPageXY(F);var B=document.elementFromPoint(C[0],C[1]);var E=g==null&&(k(B,"_jsPlumb_endpoint")||k(B,"_jsPlumb_connector"));if(s&&y){r=true;g=z;var A=D.getPageXY(F);var I=A[0]-q[0];var H=A[1]-q[1];var G={left:y.left+I,top:y.top+H};D.setOffset(D.getElementObject(z.source),G);p.repaint(z.source);G={left:t.left+I,top:t.top+H};D.setOffset(D.getElementObject(z.target),G);p.repaint(z.target)}else{if(!x&&E&&z._over(F)){x=true;z.setHover(x);z.fireUpdate("mouseenter",z,F)}else{if(x&&(!z._over(F)||!E)){x=false;z.setHover(x);z.fireUpdate("mouseexit",z,F)}}}};this.setHover=function(A,B){if(z.hoverPaintStyle!=null){z.paintStyleInUse=A?z.hoverPaintStyle:z.paintStyle;z.repaint();if(!B){w(A)}}};var w=function(C){var B=z.getAttachedElements();if(B){for(var A=0;A<B.length;A++){B[A].setHover(C,true)}}};this.click=function(A){if(x&&z._over(A)&&!r){z.fireUpdate("click",z,A)}r=false};this.dblclick=function(A){if(x&&z._over(A)&&!r){z.fireUpdate("dblclick",z,A)}r=false};this.mousedown=function(A){if(z._over(A)&&!s){s=true;q=p.CurrentLibrary.getPageXY(A);v=p.CurrentLibrary.getOffset(p.CurrentLibrary.getElementObject(z.canvas));y=p.CurrentLibrary.getOffset(p.CurrentLibrary.getElementObject(z.source));t=p.CurrentLibrary.getOffset(p.CurrentLibrary.getElementObject(z.target))}};this.mouseup=function(){if(z==g){g=null}s=false};this.setPaintStyle=function(A){z.paintStyle=A;z.paintStyleInUse=z.paintStyle;z.repaint()};this.setHoverPaintStyle=function(A){z.hoverPaintStyle=A;z.repaint()}};var n=function(t){this.Defaults={Anchor:null,Anchors:[null,null],BackgroundPaintStyle:null,Connector:null,Container:null,DragOptions:{},DropOptions:{},Endpoint:null,Endpoints:[null,null],EndpointStyle:{fillStyle:null},EndpointStyles:[null,null],EndpointHoverStyle:null,EndpointHoverStyles:[null,null],HoverPaintStyle:null,LabelStyle:{fillStyle:"rgba(0,0,0,0)",color:"black"},LogEnabled:true,MaxConnections:null,MouseEventsEnabled:false,PaintStyle:{lineWidth:10,strokeStyle:"red"},Scope:"_jsPlumb_DefaultScope"};if(t){p.extend(this.Defaults,t)}this.logEnabled=this.Defaults.LogEnabled;a.apply(this);var w=this;var z=null;var ad=function(){p.repaintEverything()};var s=true;function ac(){if(s){ad()}}var ab=null;var D={};var aa={};var L={};var O={};var v={};var R={};var Z={};var ai=this.Defaults.MouseEventsEnabled;var Q=true;var Y=[];var I=[];var ae={};var u="DEFAULT";var T=1200;var X=function(aq,ar,ao,av){var au=function(ay,ax){if(ay===ax){return true}else{if(typeof ay=="object"&&typeof ax=="object"){var az=true;for(var aw in ay){if(!au(ay[aw],ax[aw])){az=false;break}}for(var aw in ax){if(!au(ax[aw],ay[aw])){az=false;break}}return az}}};for(var at=+ao||0,ap=aq.length;at<ap;at++){if(au(aq[at],ar)){return at}}return -1};var K=function(ao,ap){if(!ap){document.body.appendChild(ao)}else{p.CurrentLibrary.appendElement(ao,ap)}};var ak=function(){return""+(new Date()).getTime()};var al=function(au,aB,ax){var ao=m(au,"id");var ap=aa[ao];if(!ax){ax=ak()}if(ap){x({elId:ao,offset:aB,recalc:false,timestamp:ax});var ay=O[ao],aw=I[ao];for(var av=0;av<ap.length;av++){ap[av].paint({timestamp:ax,offset:ay,dimensions:aw});var aq=ap[av].connections;for(var at=0;at<aq.length;at++){aq[at].paint({elId:ao,ui:aB,recalc:false,timestamp:ax});var aD=aq[at].endpoints[0]==ap[av]?1:0;if(aq[at].endpoints[aD].anchor.isDynamic&&!aq[at].endpoints[aD].isFloating()){var ar=aD==0?aq[at].sourceId:aq[at].targetId;var az=O[ar],aA=I[ar];var aC=aq[at].endpoints[aD].anchor.compute({xy:[az.left,az.top],wh:aA,element:aq[at].endpoints[aD],txy:[ay.left,ay.top],twh:aw,tElement:ap[av]});aq[at].endpoints[aD].paint({anchorLoc:aC})}}}}};var C=function(ap,ar){var at=null;if(ap.constructor==Array){at=[];for(var ao=0;ao<ap.length;ao++){var aq=b(ap[ao]),au=m(aq,"id");at.push(ar(aq,au))}}else{var aq=b(ap),au=m(aq,"id");at=ar(aq,au)}return at};var y=function(ao){if(w.logEnabled&&typeof console!="undefined"){console.log(ao)}};var P=function(ao){return L[ao]};var H=function(at,ar,aq){var ao=ar==null?Q:ar;if(ao){if(p.CurrentLibrary.isDragSupported(at)&&!p.CurrentLibrary.isAlreadyDraggable(at)){var ap=aq||w.Defaults.DragOptions||p.Defaults.DragOptions;ap=p.extend({},ap);var av=p.CurrentLibrary.dragEvents.drag;var au=p.CurrentLibrary.dragEvents.stop;ap[av]=af(ap[av],function(){var aw=p.CurrentLibrary.getUIPosition(arguments);al(at,aw);l(at,"jsPlumb_dragged")});ap[au]=af(ap[au],function(){var aw=p.CurrentLibrary.getUIPosition(arguments);al(at,aw);c(at,"jsPlumb_dragged")});var ao=Z[an(at)];ap.disabled=ao==null?false:!ao;p.CurrentLibrary.initDraggable(at,ap)}}};var N=function(ap){var ao=document.createElement("canvas");K(ao,ap.container);ao.style.position="absolute";if(ap["class"]){ao.className=ap["class"]}an(ao,ap.uuid);if(d){p.sizeCanvas(ao,0,0,T,T);ao=G_vmlCanvasManager.initElement(ao)}return ao};var am=function(ap){var ao=p.Defaults.ConnectionType||A;return new ao(ap)};var ag=function(ap){var ao=p.Defaults.EndpointType||aj;return new ao(ap)};var M=function(aq,at){var ao=aa[aq];if(ao&&ao.length){for(var ar=0;ar<ao.length;ar++){for(var ap=0;ap<ao[ar].connections.length;ap++){var au=at(ao[ar].connections[ap]);if(au){return}}}}};var E=function(ap){for(var ao in aa){M(ao,ap)}};var W=function(ao,ap){if(ao!=null){if(!ap){try{document.body.removeChild(ao)}catch(aq){}}else{p.CurrentLibrary.removeElement(ao,ap)}}};var J=function(aq,ap){for(var ao=0;ao<aq.length;ao++){W(aq[ao],ap)}};var F=function(at,aq,ar){if(aq!=null){var ao=at[aq];if(ao!=null){var ap=X(ao,ar);if(ap>=0){delete (ao[ap]);ao.splice(ap,1);return true}}}return false};var q=function(ap,ao){return C(ap,function(aq,ar){Z[ar]=ao;if(p.CurrentLibrary.isDragSupported(aq)){p.CurrentLibrary.setDraggable(aq,ao)}})};var ah=function(ao,ap){M(m(ao,"id"),function(aq){aq.canvas.style.display=ap})};var G=function(ao){return C(ao,function(aq,ap){var ar=Z[ap]==null?Q:Z[ap];ar=!ar;Z[ap]=ar;p.CurrentLibrary.setDraggable(aq,ar);return ar})};var r=function(ao){M(ao,function(aq){var ap=("none"==aq.canvas.style.display);aq.canvas.style.display=ap?"block":"none"})};var x=function(au){var ar=au.timestamp,ao=au.recalc,at=au.offset,ap=au.elId;if(!ao){if(ar&&ar===v[ap]){return}}if(ao||at==null){var aq=b(ap);if(aq!=null){I[ap]=e(aq);O[ap]=o(aq);v[ap]=ar}}else{O[ap]=at}};var an=function(ao,ap){var aq=b(ao);var ar=m(aq,"id");if(!ar||ar=="undefined"){if(arguments.length==2&&arguments[1]!=undefined){ar=ap}else{ar="jsPlumb_"+ak()}f(aq,"id",ar)}return ar};var af=function(aq,ao,ap){aq=aq||function(){};ao=ao||function(){};return function(){var ar=null;try{ar=ao.apply(this,arguments)}catch(at){y("jsPlumb function failed : "+at)}if(ap==null||(ar!==ap)){try{aq.apply(this,arguments)}catch(at){y("wrapped function failed : "+at)}}return ar}};this.connectorClass="_jsPlumb_connector";this.endpointClass="_jsPlumb_endpoint";this.overlayClass="_jsPlumb_overlay";this.Anchors={};this.Connectors={};this.Endpoints={};this.Overlays={};this.addEndpoint=function(au,ar,ay){ay=ay||{};var ap=p.extend({},ay);p.extend(ap,ar);ap.endpoint=ap.endpoint||w.Defaults.Endpoint||p.Defaults.Endpoint;ap.endpointStyle=ap.endpointStyle||w.Defaults.EndpointStyle||p.Defaults.EndpointStyle;var aq=b(au),ao=m(aq,"id");ap.source=aq;x({elId:ao});var av=ag(ap);h(aa,ao,av);var aw=O[ao],at=I[ao];var ax=av.anchor.compute({xy:[aw.left,aw.top],wh:at,element:av});av.paint({anchorLoc:ax});return av};this.addEndpoints=function(at,ap,ao){var ar=[];for(var aq=0;aq<ap.length;aq++){ar.push(w.addEndpoint(at,ap[aq],ao))}return ar};this.animate=function(aq,ap,ao){var ar=b(aq),av=m(aq,"id");ao=ao||{};var au=p.CurrentLibrary.dragEvents.step;var at=p.CurrentLibrary.dragEvents.complete;ao[au]=af(ao[au],function(){w.repaint(av)});ao[at]=af(ao[at],function(){w.repaint(av)});p.CurrentLibrary.animate(ar,ap,ao)};this.connect=function(av,aq){var ap=p.extend({},av);if(aq){p.extend(ap,aq)}if(ap.source&&ap.source.endpoint){ap.sourceEndpoint=ap.source}if(ap.source&&ap.target.endpoint){ap.targetEndpoint=ap.target}if(av.uuids){ap.sourceEndpoint=P(av.uuids[0]);ap.targetEndpoint=P(av.uuids[1])}if(ap.sourceEndpoint&&ap.sourceEndpoint.isFull()){y("could not add connection; source endpoint is full");return}if(ap.targetEndpoint&&ap.targetEndpoint.isFull()){y("could not add connection; target endpoint is full");return}if(ap.dynamicAnchors){var ar=ap.dynamicAnchors.constructor==Array;var ao=ar?new S(p.makeAnchors(ap.dynamicAnchors)):new S(p.makeAnchors(ap.dynamicAnchors.source));var at=ar?new S(p.makeAnchors(ap.dynamicAnchors)):new S(p.makeAnchors(ap.dynamicAnchors.target));ap.anchors=[ao,at]}var au=am(ap);h(D,au.scope,au);w.fireUpdate("jsPlumbConnection",{source:au.source,target:au.target,sourceId:au.sourceId,targetId:au.targetId,sourceEndpoint:au.endpoints[0],targetEndpoint:au.endpoints[1]});al(au.source);return au};this.deleteEndpoint=function(ap){var av=(typeof ap=="string")?L[ap]:ap;if(av){var ar=av.getUuid();if(ar){L[ar]=null}av.detachAll();W(av.canvas,av.container);for(var au in aa){var ao=aa[au];if(ao){var at=[];for(var aq=0;aq<ao.length;aq++){if(ao[aq]!=av){at.push(ao[aq])}}aa[au]=at}}delete av}};this.deleteEveryEndpoint=function(){for(var aq in aa){var ao=aa[aq];if(ao&&ao.length){for(var ap=0;ap<ao.length;ap++){w.deleteEndpoint(ao[ap])}}}delete aa;aa={};delete L;L={}};var V=function(ao){w.fireUpdate("jsPlumbConnectionDetached",{source:ao.source,target:ao.target,sourceId:ao.sourceId,targetId:ao.targetId,sourceEndpoint:ao.endpoints[0],targetEndpoint:ao.endpoints[1]})};this.detach=function(ao,at){if(arguments.length==2){var ax=b(ao),aq=an(ax);var aw=b(at),ar=an(aw);M(aq,function(ay){if((ay.sourceId==aq&&ay.targetId==ar)||(ay.targetId==aq&&ay.sourceId==ar)){W(ay.canvas,ay.container);ay.endpoints[0].removeConnection(ay);ay.endpoints[1].removeConnection(ay);F(D,ay.scope,ay)}})}else{if(arguments.length==1){if(arguments[0].constructor==A){arguments[0].endpoints[0].detachFrom(arguments[0].endpoints[1])}else{if(arguments[0].connection){arguments[0].connection.endpoints[0].detachFrom(arguments[0].connection.endpoints[1])}else{var ap=p.extend({},ao);if(ap.uuids){P(ap.uuids[0]).detachFrom(P(ap.uuids[1]))}else{if(ap.sourceEndpoint&&ap.targetEndpoint){ap.sourceEndpoint.detachFrom(ap.targetEndpoint)}else{var av=an(ap.source);var au=an(ap.target);M(av,function(ay){if((ay.sourceId==av&&ay.targetId==au)||(ay.targetId==av&&ay.sourceId==au)){W(ay.canvas,ay.container);ay.endpoints[0].removeConnection(ay);ay.endpoints[1].removeConnection(ay);F(D,ay.scope,ay)}})}}}}}}};this.detachAllConnections=function(aq){var ar=m(aq,"id");var ao=aa[ar];if(ao&&ao.length){for(var ap=0;ap<ao.length;ap++){ao[ap].detachAll()}}};this.detachAll=this.detachAllConnections;this.detachEveryConnection=function(){for(var aq in aa){var ao=aa[aq];if(ao&&ao.length){for(var ap=0;ap<ao.length;ap++){ao[ap].detachAll()}}}delete D;D={}};this.detachEverything=this.detachEveryConnection;this.draggable=function(aq,ao){if(typeof aq=="object"&&aq.length){for(var ap=0;ap<aq.length;ap++){var ar=b(aq[ap]);if(ar){H(ar,true,ao)}}}else{if(aq._nodes){for(var ap=0;ap<aq._nodes.length;ap++){var ar=b(aq._nodes[ap]);if(ar){H(ar,true,ao)}}}else{var ar=b(aq);if(ar){H(ar,true,ao)}}}};this.extend=function(ap,ao){return p.CurrentLibrary.extend(ap,ao)};this.getDefaultEndpointType=function(){return aj};this.getDefaultConnectionType=function(){return A};this.getConnections=function(ay){var ao={};ay=ay||{};var ax=function(az){var aA=[];if(az){if(typeof az=="string"){aA.push(az)}else{aA=az}}return aA};var aw=ax(ay.scope);var ap=ax(ay.source);var au=ax(ay.target);var aq=function(aA,az){return aA.length>0?X(aA,az)!=-1:true};for(var at in D){if(aq(aw,at)){ao[at]=[];for(var ar=0;ar<D[at].length;ar++){var av=D[at][ar];if(aq(ap,av.sourceId)&&aq(au,av.targetId)){ao[at].push({sourceId:av.sourceId,targetId:av.targetId,source:av.source,target:av.target,sourceEndpoint:av.endpoints[0],targetEndpoint:av.endpoints[1],connection:av})}}}}return ao};this.getDefaultScope=function(){return u};this.getEndpoint=P;this.getId=an;this.hide=function(ao){ah(ao,"none")};this.init=function(){var ao=function(ap){p.CurrentLibrary.bind(document,ap,function(av){if(!w.currentlyDragging&&ai){for(var au in D){var aw=D[au];for(var ar=0;ar<aw.length;ar++){if(aw[ar][ap](av)){return}}}for(var at in aa){var aq=aa[at];for(var ar=0;ar<aq.length;ar++){if(aq[ar][ap](av)){return}}}}})};ao("click");ao("dblclick");ao("mousemove");ao("mousedown");ao("mouseup")};this.makeAnchor=function(aw,at,au,aq,ar,ao){if(arguments.length==0){return null}var ap={};if(arguments.length==1){var ax=arguments[0];if(ax.compute&&ax.getOrientation){return ax}else{if(typeof ax=="string"){return w.Anchors[arguments[0]]()}else{if(ax.constructor==Array){if(ax[0].constructor==Array||ax[0].constructor==String){return new S(ax)}else{return p.makeAnchor.apply(this,ax)}}else{if(typeof arguments[0]=="object"){p.extend(ap,aw)}}}}}else{ap={x:aw,y:at};if(arguments.length>=4){ap.orientation=[arguments[2],arguments[3]]}if(arguments.length==6){ap.offsets=[arguments[4],arguments[5]]}}var av=new U(ap);av.clone=function(){return new U(ap)};return av};this.makeAnchors=function(ap){var aq=[];for(var ao=0;ao<ap.length;ao++){if(typeof ap[ao]=="string"){aq.push(w.Anchors[ap[ao]]())}else{if(ap[ao].constructor==Array){aq.push(p.makeAnchor(ap[ao]))}}}return aq};this.makeDynamicAnchor=function(ao,ap){return new S(ao,ap)};this.repaint=function(ap){var aq=function(ar){al(b(ar))};if(typeof ap=="object"){for(var ao=0;ao<ap.length;ao++){aq(ap[ao])}}else{aq(ap)}};this.repaintEverything=function(){var ap=ak();for(var ao in aa){al(b(ao),null,ap)}};this.removeAllEndpoints=function(aq){var ao=m(aq,"id");var ar=aa[ao];for(var ap in ar){w.deleteEndpoint(ar[ap])}aa[ao]=[]};this.removeEveryEndpoint=this.deleteEveryEndpoint;this.removeEndpoint=function(ao,ap){w.deleteEndpoint(ap)};this.reset=function(){this.deleteEveryEndpoint();this.clearListeners()};this.setAutomaticRepaint=function(ao){s=ao};this.setDefaultNewCanvasSize=function(ao){T=ao};this.setDefaultScope=function(ao){u=ao};this.setDraggable=q;this.setDraggableByDefault=function(ao){Q=ao};this.setDebugLog=function(ao){z=ao};this.setRepaintFunction=function(ao){ad=ao};this.setMouseEventsEnabled=function(ao){ai=ao};this.show=function(ao){ah(ao,"block")};this.sizeCanvas=function(aq,ao,at,ap,ar){if(aq){aq.style.height=ar+"px";aq.height=ar;aq.style.width=ap+"px";aq.width=ap;aq.style.left=ao+"px";aq.style.top=at+"px"}};this.getTestHarness=function(){return{endpointsByElement:aa,endpointCount:function(ao){var ap=aa[ao];return ap?ap.length:0},connectionCount:function(ao){ao=ao||u;var ap=D[ao];return ap?ap.length:0},findIndex:X,getId:an}};this.toggle=r;this.toggleVisible=r;this.toggleDraggable=G;this.unload=function(){delete aa;delete L;delete O;delete I;delete R;delete Z;delete Y};this.wrap=af;this.addListener=this.bind;var U=function(at){var aq=this;this.x=at.x||0;this.y=at.y||0;var ap=at.orientation||[0,0];var ar=null,ao=null;this.offsets=at.offsets||[0,0];aq.timestamp=null;this.compute=function(az){var aE=az.xy,av=az.wh,aA=az.element,aB=az.timestamp;if(aB&&aB===aq.timestamp){return ao}ao=[aE[0]+(aq.x*av[0])+aq.offsets[0],aE[1]+(aq.y*av[1])+aq.offsets[1]];var aw=aA?aA.container:null;var aC={left:0,top:0};if(aw!=null){var au=b(aw);var ax=o(au);var ay=p.CurrentLibrary.getScrollLeft(au);var aD=p.CurrentLibrary.getScrollTop(au);aC.left=ax.left-ay;aC.top=ax.top-aD;ao[0]=ao[0]-aC.left;ao[1]=ao[1]-aC.top}aq.timestamp=aB;return ao};this.getOrientation=function(){return ap};this.equals=function(au){if(!au){return false}var av=au.getOrientation();var aw=this.getOrientation();return this.x==au.x&&this.y==au.y&&this.offsets[0]==au.offsets[0]&&this.offsets[1]==au.offsets[1]&&aw[0]==av[0]&&aw[1]==av[1]};this.getCurrentLocation=function(){return ao}};var B=function(av){var at=av.reference;var au=av.referenceCanvas;var aq=e(b(au));var ap=0,aw=0;var ao=null;var ar=null;this.compute=function(aB){var az=aB.xy,ay=aB.element;var ax=[az[0]+(aq[0]/2),az[1]+(aq[1]/2)];if(ay.container!=null){var aA=o(ay.container);ax[0]=ax[0]-aA.left;ax[1]=ax[1]-aA.top}ar=ax;return ax};this.getOrientation=function(){if(ao){return ao}else{var ax=at.getOrientation();return[Math.abs(ax[0])*ap*-1,Math.abs(ax[1])*aw*-1]}};this.over=function(ax){ao=ax.getOrientation()};this.out=function(){ao=null};this.getCurrentLocation=function(){return ar}};var S=function(aq,ap){this.isSelective=true;this.isDynamic=true;var ay=aq||[];var aw=function(az){return az.constructor==U?az:p.makeAnchor(az)};for(var av=0;av<ay.length;av++){ay[av]=aw(ay[av])}this.addAnchor=function(az){ay.push(aw(az))};this.getAnchors=function(){return ay};var ar=ay.length>0?ay[0]:null;var au=ay.length>0?0:-1;this.locked=false;var ax=this;var at=function(aB,az,aF,aE,aA){var aD=aE[0]+(aB.x*aA[0]),aC=aE[1]+(aB.y*aA[1]);return Math.sqrt(Math.pow(az-aD,2)+Math.pow(aF-aC,2))};var ao=ap||function(aJ,aA,aB,aC,az){var aE=aB[0]+(aC[0]/2),aD=aB[1]+(aC[1]/2);var aG=-1,aI=Infinity;for(var aF=0;aF<az.length;aF++){var aH=at(az[aF],aE,aD,aJ,aA);if(aH<aI){aG=aF+0;aI=aH}}return az[aG]};this.compute=function(aD){var aC=aD.xy,az=aD.wh,aB=aD.timestamp,aA=aD.txy,aF=aD.twh;if(ax.locked||aA==null||aF==null){return ar.compute(aD)}else{aD.timestamp=null}ar=ao(aC,az,aA,aF,ay);var aE=ar.compute(aD);return aE};this.getCurrentLocation=function(){var az=ar!=null?ar.getCurrentLocation():null;return az};this.getOrientation=function(){return ar!=null?ar.getOrientation():[0,0]};this.over=function(az){if(ar!=null){ar.over(az)}};this.out=function(){if(ar!=null){ar.out()}}};var A=function(aH){a.apply(this);var ax=this;var ap=true;this.isVisible=function(){return ap};this.setVisible=function(aJ){ap=aJ;if(ax.canvas){ax.canvas.style.display=aJ?"block":"none"}};var aA=new String("_jsplumb_c_"+(new Date()).getTime());this.getId=function(){return aA};this.container=aH.container||w.Defaults.Container;this.source=b(aH.source);this.target=b(aH.target);if(aH.sourceEndpoint){this.source=aH.sourceEndpoint.getElement()}if(aH.targetEndpoint){this.target=aH.targetEndpoint.getElement()}this.sourceId=m(this.source,"id");this.targetId=m(this.target,"id");this.endpointsOnTop=aH.endpointsOnTop!=null?aH.endpointsOnTop:true;this.getAttachedElements=function(){return ax.endpoints};this.scope=aH.scope;this.endpoints=[];this.endpointStyles=[];var aG=function(aJ){if(aJ){return p.makeAnchor(aJ)}};var aD=function(aJ,aM,aK,aL){if(aJ){ax.endpoints[aM]=aJ;aJ.addConnection(ax)}else{if(!aK.endpoints){aK.endpoints=[null,null]}var aS=aK.endpoints[aM]||aK.endpoint||w.Defaults.Endpoints[aM]||p.Defaults.Endpoints[aM]||w.Defaults.Endpoint||p.Defaults.Endpoint||new p.Endpoints.Dot();if(aS.constructor==String){aS=new p.Endpoints[aS]()}else{if(aS.constructor==Array){aS=new p.Endpoints[aS[0]](aS[1])}}if(!aK.endpointStyles){aK.endpointStyles=[null,null]}if(!aK.endpointHoverStyles){aK.endpointHoverStyles=[null,null]}var aQ=aK.endpointStyles[aM]||aK.endpointStyle||w.Defaults.EndpointStyles[aM]||p.Defaults.EndpointStyles[aM]||w.Defaults.EndpointStyle||p.Defaults.EndpointStyle;var aO=aK.endpointHoverStyles[aM]||aK.endpointHoverStyle||w.Defaults.EndpointHoverStyles[aM]||p.Defaults.EndpointHoverStyles[aM]||w.Defaults.EndpointHoverStyle||p.Defaults.EndpointHoverStyle;var aP=aK.anchors?aK.anchors[aM]:aG(w.Defaults.Anchors[aM])||aG(p.Defaults.Anchors[aM])||aG(w.Defaults.Anchor)||aG(p.Defaults.Anchor)||aG("BottomCenter");var aR=aK.uuids?aK.uuids[aM]:null;var aN=ag({paintStyle:aQ,hoverPaintStyle:aO,endpoint:aS,connections:[ax],uuid:aR,anchor:aP,source:aL,container:ax.container});ax.endpoints[aM]=aN;return aN}};var az=aD(aH.sourceEndpoint,0,aH,ax.source);if(az){h(aa,this.sourceId,az)}var ay=aD(aH.targetEndpoint,1,aH,ax.target);if(ay){h(aa,this.targetId,ay)}if(!this.scope){this.scope=this.endpoints[0].scope}this.connector=this.endpoints[0].connector||this.endpoints[1].connector||aH.connector||w.Defaults.Connector||p.Defaults.Connector||new p.Connectors.Bezier();if(this.connector.constructor==String){this.connector=new p.Connectors[this.connector]()}else{if(this.connector.constructor==Array){this.connector=new p.Connectors[this.connector[0]](this.connector[1])}}this.paintStyle=this.endpoints[0].connectorStyle||this.endpoints[1].connectorStyle||aH.paintStyle||w.Defaults.PaintStyle||p.Defaults.PaintStyle;var aw=this.endpoints[0].connectorBackgroundStyle||this.endpoints[1].connectorBackgroundStyle||aH.backgroundPaintStyle||w.Defaults.BackgroundPaintStyle||p.Defaults.BackgroundPaintStyle;this.hoverPaintStyle=this.endpoints[0].connectorHoverStyle||this.endpoints[1].connectorHoverStyle||aH.hoverPaintStyle||w.Defaults.HoverPaintStyle||p.Defaults.HoverPaintStyle;this.paintStyleInUse=this.paintStyle;this.overlays=[];if(aH.overlays){for(var aF=0;aF<aH.overlays.length;aF++){var aE=aH.overlays[aF];if(aE.constructor==Array){var ar=aE[0];var aB=p.CurrentLibrary.extend({connection:ax},aE[1]);if(aE.length==3){p.CurrentLibrary.extend(aB,aE[2])}this.overlays.push(new p.Overlays[ar](aB))}else{if(aE.constructor==String){this.overlays.push(new p.Overlays[aE]({connection:ax}))}else{this.overlays.push(aE)}}}}var aI=[];this.addOverlay=function(aJ){overlays.push(aJ)};this.labelStyle=aH.labelStyle||w.Defaults.LabelStyle||p.Defaults.LabelStyle;this.label=aH.label;if(this.label){this.overlays.push(new p.Overlays.Label({labelStyle:this.labelStyle,label:this.label,connection:ax}))}x({elId:this.sourceId});x({elId:this.targetId});this.setLabel=function(aJ){ax.label=aJ;w.repaint(ax.source)};var au=O[this.sourceId],at=I[this.sourceId];var ao=O[this.targetId];var av=I[this.targetId];var aC=this.endpoints[0].anchor.compute({xy:[au.left,au.top],wh:at,element:this.endpoints[0],txy:[ao.left,ao.top],twh:av,tElement:this.endpoints[1]});this.endpoints[0].paint({anchorLoc:aC});aC=this.endpoints[1].anchor.compute({xy:[ao.left,ao.top],wh:av,element:this.endpoints[1],txy:[au.left,au.top],twh:at,tElement:this.endpoints[0]});this.endpoints[1].paint({anchorLoc:aC});var aq=N({"class":p.connectorClass,container:ax.container});this.canvas=aq;this.setBackgroundPaintStyle=function(aJ){aw=aJ;ax.repaint()};this.paint=function(a4){a4=a4||{};var aT=a4.elId,aV=a4.ui,aR=a4.recalc,aK=a4.timestamp;var aN=ax.floatingAnchorIndex;var aW=false;var a3=aW?this.sourceId:this.targetId,aQ=aW?this.targetId:this.sourceId;var aL=aW?0:1,a5=aW?1:0;var aJ=aW?this.target:this.source;if(this.canvas.getContext){x({elId:aT,offset:aV,recalc:aR,timestamp:aK});x({elId:a3,timestamp:aK});var aY=aq.getContext("2d");var aO=this.endpoints[a5].anchor.getCurrentLocation();var aP=this.endpoints[a5].anchor.getOrientation();var a1=this.endpoints[aL].anchor.getCurrentLocation();var a2=this.endpoints[aL].anchor.getOrientation();var aM=0;for(var a0=0;a0<ax.overlays.length;a0++){var aX=ax.overlays[a0];var aU=aX.computeMaxSize(ax.connector,aY);if(aU>aM){aM=aU}}var aZ=this.connector.compute(aO,a1,this.endpoints[a5].anchor,this.endpoints[aL].anchor,ax.paintStyleInUse.lineWidth,aM);p.sizeCanvas(aq,aZ[0],aZ[1],aZ[2],aZ[3]);var aS=function(a6,a8){a6.save();p.extend(a6,a8);if(a8.gradient&&!d){var a9=ax.connector.createGradient(aZ,a6,(aT==this.sourceId));for(var a7=0;a7<a8.gradient.stops.length;a7++){a9.addColorStop(a8.gradient.stops[a7][0],a8.gradient.stops[a7][1])}a6.strokeStyle=a9}ax.connector.paint(aZ,a6);a6.restore()};if(aw!=null){aS(aY,aw)}aS(aY,ax.paintStyleInUse);for(var a0=0;a0<ax.overlays.length;a0++){var aX=ax.overlays[a0];ax.overlayPlacements[a0]=aX.draw(ax.connector,aY,ax.paintStyleInUse)}}};this.repaint=function(){this.paint({elId:this.sourceId,recalc:true})};H(ax.source,aH.draggable,aH.dragOptions);H(ax.target,aH.draggable,aH.dragOptions);if(this.source.resize){this.source.resize(function(aJ){p.repaint(ax.sourceId)})}};var aj=function(aN){a.apply(this);aN=aN||{};var aC=this;var ap=true;this.isVisible=function(){return ap};this.setVisible=function(aP,aS,aO){ap=aP;if(aC.canvas){aC.canvas.style.display=aP?"block":"none"}if(!aS){for(var aR=0;aR<aC.connections.length;aR++){aC.connections[aR].setVisible(aP);if(!aO){var aQ=aC===aC.connections[aR].endpoints[0]?1:0;if(aC.connections[aR].endpoints[aQ].connections.length==1){aC.connections[aR].endpoints[aQ].setVisible(aP,true,true)}}}}};var aD=new String("_jsplumb_e_"+(new Date()).getTime());this.getId=function(){return aD};if(aN.dynamicAnchors){aC.anchor=new S(p.makeAnchors(aN.dynamicAnchors))}else{aC.anchor=aN.anchor?p.makeAnchor(aN.anchor):aN.anchors?p.makeAnchor(aN.anchors):p.makeAnchor("TopCenter")}var aA=aN.endpoint||new p.Endpoints.Dot();if(aA.constructor==String){aA=new p.Endpoints[aA]()}else{if(aA.constructor==Array){aA=new p.Endpoints[aA[0]](aA[1])}}aC.endpoint=aA;this.paintStyle=aN.paintStyle||aN.style||w.Defaults.EndpointStyle||p.Defaults.EndpointStyle;this.hoverPaintStyle=aN.hoverPaintStyle||w.Defaults.EndpointHoverStyle||p.Defaults.EndpointHoverStyle;this.paintStyleInUse=this.paintStyle;this.connectorStyle=aN.connectorStyle;this.connectorBackgroundStyle=aN.connectorBackgroundStyle;this.connectorHoverStyle=aN.connectorHoverStyle;this.connectorOverlays=aN.connectorOverlays;this.connector=aN.connector;this.isSource=aN.isSource||false;this.isTarget=aN.isTarget||false;var aB=aN.source,ax=aN.uuid;var aL=null,ar=null;if(ax){L[ax]=aC}this.container=aN.container||w.Defaults.Container||p.Defaults.Container;var av=m(aB,"id");this.elementId=av;var aI=aN.maxConnections||1;this.getAttachedElements=function(){return aC.connections};this.canvas=aN.canvas||N({"class":p.endpointClass,container:this.container,uuid:aN.uuid});this.connections=aN.connections||[];this.scope=aN.scope||u;this.timestamp=null;var az=aN.reattach||false;var ay=aN.dragAllowedWhenFull||true;this.computeAnchor=function(aO){return aC.anchor.compute(aO)};this.addConnection=function(aO){aC.connections.push(aO)};this.detach=function(aP,aR){var aO=X(aC.connections,aP);if(aO>=0){aC.connections.splice(aO,1);if(!aR){var aQ=aP.endpoints[0]==aC?aP.endpoints[1]:aP.endpoints[0];aQ.detach(aP,true)}W(aP.canvas,aP.container);F(D,aP.scope,aP);if(!aR){V(aP)}}};this.detachAll=function(){while(aC.connections.length>0){aC.detach(aC.connections[0])}};this.detachFrom=function(aP){var aQ=[];for(var aO=0;aO<aC.connections.length;aO++){if(aC.connections[aO].endpoints[1]==aP||aC.connections[aO].endpoints[0]==aP){aQ.push(aC.connections[aO])}}for(var aO=0;aO<aQ.length;aO++){aQ[aO].setHover(false);aC.detach(aQ[aO])}};this.detachFromConnection=function(aP){var aO=X(aC.connections,aP);if(aO>=0){aC.connections.splice(aO,1)}};this.getElement=function(){return aB};this.getUuid=function(){return ax};this.makeInPlaceCopy=function(){var aO=ag({anchor:aC.anchor,source:aB,paintStyle:this.paintStyle,endpoint:aA});return aO};this.isConnectedTo=function(aQ){var aP=false;if(aQ){for(var aO=0;aO<aC.connections.length;aO++){if(aC.connections[aO].endpoints[1]==aQ){aP=true;break}}}return aP};this.isFloating=function(){return aL!=null};this.connectorSelector=function(){return(aC.connections.length<aI)?null:aC.connections[0]};this.isFull=function(){return aI<1?false:(aC.connections.length>=aI)};this.setDragAllowedWhenFull=function(aO){ay=aO};this.setPaintStyle=this.setPaintStyle;this.setHoverPaintStyle=this.setHoverPaintStyle;this.setStyle=aC.setPaintStyle;this.equals=function(aO){return this.anchor.equals(aO.anchor)};this.paint=function(aR){aR=aR||{};var aV=aR.timestamp;if(!aV||aC.timestamp!==aV){var aU=aR.anchorPoint,aQ=aR.canvas,aS=aR.connectorPaintStyle;if(aU==null){var a0=aR.offset||O[av];var aO=aR.dimensions||I[av];if(a0==null||aO==null){x({elId:av,timestamp:aV});a0=O[av];aO=I[av]}var aP={xy:[a0.left,a0.top],wh:aO,element:aC,timestamp:aV};if(aC.anchor.isDynamic){if(aC.connections.length>0){var aX=aC.connections[0];var aZ=aX.endpoints[0]==aC?1:0;var aT=aZ==0?aX.sourceId:aX.targetId;var aW=O[aT],aY=I[aT];aP.txy=[aW.left,aW.top];aP.twh=aY;aP.tElement=aX.endpoints[aZ]}}aU=aC.anchor.compute(aP)}aA.paint(aU,aC.anchor.getOrientation(),aQ||aC.canvas,aC.paintStyleInUse,aS||aC.paintStyleInUse);aC.timestamp=aV}};this.repaint=this.paint;this.removeConnection=this.detach;if(aN.isSource&&p.CurrentLibrary.isDragSupported(aB)){var aH=null,aD=null,aG=null,ao=false,aq=null;var at=function(){aG=aC.connectorSelector();if(aC.isFull()&&!ay){return false}x({elId:av});ar=aC.makeInPlaceCopy();ar.paint();aH=document.createElement("div");var aS=b(aH);K(aH,aC.container);var aU=an(aS);x({elId:aU});f(b(aC.canvas),"dragId",aU);f(b(aC.canvas),"elId",av);var aP=new B({reference:aC.anchor,referenceCanvas:aC.canvas});aL=ag({paintStyle:{fillStyle:"rgba(0,0,0,0)"},endpoint:aA,anchor:aP,source:aS});if(aG==null){aC.anchor.locked=true;aG=am({sourceEndpoint:aC,targetEndpoint:aL,source:b(aB),target:b(aH),anchors:[aC.anchor,aP],paintStyle:aN.connectorStyle,hoverPaintStyle:aN.connectorHoverStyle,backgroundPaintStyle:aN.connectorBackgroundStyle,connector:aN.connector,overlays:aN.connectorOverlays});aG.setHover(false)}else{ao=true;aG.setHover(false);au(b(ar.canvas));var aO=aG.sourceId==av?0:1;aG.floatingAnchorIndex=aO;aC.detachFromConnection(aG);var aT=b(aC.canvas);var aR=p.CurrentLibrary.getDragScope(aT);f(aT,"originalScope",aR);var aQ=aR;if(aO==0){aq=[aG.source,aG.sourceId,aK,aR];aG.source=b(aH);aG.sourceId=aU;aQ=p.CurrentLibrary.getDragScope(b(aG.endpoints[1].canvas))}else{aq=[aG.target,aG.targetId,aK,aR];aG.target=b(aH);aG.targetId=aU;aQ=p.CurrentLibrary.getDragScope(b(aG.endpoints[0].canvas))}p.CurrentLibrary.setDragScope(aK,aQ);aG.endpoints[aO==0?1:0].anchor.locked=true;aG.suspendedEndpoint=aG.endpoints[aO];aG.endpoints[aO]=aL}R[aU]=aG;aL.addConnection(aG);h(aa,aU,aL);w.currentlyDragging=true};var aJ=aN.dragOptions||{};var aE=p.extend({},p.CurrentLibrary.defaultDragOptions);aJ=p.extend(aE,aJ);aJ.scope=aJ.scope||aC.scope;var aF=p.CurrentLibrary.dragEvents.start;var aM=p.CurrentLibrary.dragEvents.stop;var aw=p.CurrentLibrary.dragEvents.drag;aJ[aF]=af(aJ[aF],at);aJ[aw]=af(aJ[aw],function(){var aO=p.CurrentLibrary.getUIPosition(arguments);p.CurrentLibrary.setOffset(aH,aO);al(b(aH),aO)});aJ[aM]=af(aJ[aM],function(){F(aa,aD,aL);J([aH,aL.canvas],aB);W(ar.canvas,aB);var aO=aG.floatingAnchorIndex==null?1:aG.floatingAnchorIndex;aG.endpoints[aO==0?1:0].anchor.locked=false;if(aG.endpoints[aO]==aL){if(ao&&aG.suspendedEndpoint){if(aO==0){aG.source=aq[0];aG.sourceId=aq[1]}else{aG.target=aq[0];aG.targetId=aq[1]}p.CurrentLibrary.setDragScope(aq[2],aq[3]);aG.endpoints[aO]=aG.suspendedEndpoint;if(az){aG.floatingAnchorIndex=null;aG.suspendedEndpoint.addConnection(aG);p.repaint(aq[1])}else{aG.endpoints[aO==0?1:0].detach(aG)}}else{W(aG.canvas,aC.container);aC.detachFromConnection(aG)}}aC.anchor.locked=false;aC.paint();aG.repaint();aG=null;delete ar;delete aa[aL.elementId];delete aL;w.currentlyDragging=false});var aK=b(aC.canvas);p.CurrentLibrary.initDraggable(aK,aJ)}var au=function(aR){if(aN.isTarget&&p.CurrentLibrary.isDropSupported(aB)){var aO=aN.dropOptions||w.Defaults.DropOptions||p.Defaults.DropOptions;aO=p.extend({},aO);aO.scope=aO.scope||aC.scope;var aU=null;var aS=p.CurrentLibrary.dragEvents.drop;var aT=p.CurrentLibrary.dragEvents.over;var aP=p.CurrentLibrary.dragEvents.out;var aQ=function(){var a3=b(p.CurrentLibrary.getDragObject(arguments));var aV=m(a3,"dragId");var aX=m(a3,"elId");var a2=m(a3,"originalScope");if(a2){p.CurrentLibrary.setDragScope(a3,a2)}var aZ=R[aV];var a0=aZ.floatingAnchorIndex==null?1:aZ.floatingAnchorIndex,a1=a0==0?1:0;if(!aC.isFull()&&!(a0==0&&!aC.isSource)&&!(a0==1&&!aC.isTarget)){if(a0==0){aZ.source=aB;aZ.sourceId=av}else{aZ.target=aB;aZ.targetId=av}aZ.endpoints[a0].detachFromConnection(aZ);if(aZ.suspendedEndpoint){aZ.suspendedEndpoint.detachFromConnection(aZ)}aZ.endpoints[a0]=aC;aC.addConnection(aZ);if(!aZ.suspendedEndpoint){h(D,aZ.scope,aZ);H(aB,aN.draggable,{})}else{var aY=aZ.suspendedEndpoint.getElement(),aW=aZ.suspendedEndpoint.elementId;w.fireUpdate("jsPlumbConnectionDetached",{source:a0==0?aY:aZ.source,target:a0==1?aY:aZ.target,sourceId:a0==0?aW:aZ.sourceId,targetId:a0==1?aW:aZ.targetId,sourceEndpoint:a0==0?aZ.suspendedEndpoint:aZ.endpoints[0],targetEndpoint:a0==1?aZ.suspendedEndpoint:aZ.endpoints[1],connection:aZ})}p.repaint(aX);w.fireUpdate("jsPlumbConnection",{source:aZ.source,target:aZ.target,sourceId:aZ.sourceId,targetId:aZ.targetId,sourceEndpoint:aZ.endpoints[0],targetEndpoint:aZ.endpoints[1],connection:aZ})}w.currentlyDragging=false;delete R[aV]};aO[aS]=af(aO[aS],aQ);aO[aT]=af(aO[aT],function(){var aW=p.CurrentLibrary.getDragObject(arguments);var aY=m(b(aW),"dragId");var aX=R[aY];var aV=aX.floatingAnchorIndex==null?1:aX.floatingAnchorIndex;aX.endpoints[aV].anchor.over(aC.anchor)});aO[aP]=af(aO[aP],function(){var aW=p.CurrentLibrary.getDragObject(arguments);var aY=m(b(aW),"dragId");var aX=R[aY];var aV=aX.floatingAnchorIndex==null?1:aX.floatingAnchorIndex;aX.endpoints[aV].anchor.out()});p.CurrentLibrary.initDroppable(aR,aO)}};au(b(aC.canvas));return aC}};var p=window.jsPlumb=new n();p.getInstance=function(r){var q=new n(r);return q}})();(function(){var b=!!!document.createElement("canvas").getContext;var a=function(c,f,e,d){return function(){return jsPlumb.makeAnchor(c,f,e,d)}};jsPlumb.Anchors.TopCenter=a(0.5,0,0,-1);jsPlumb.Anchors.BottomCenter=a(0.5,1,0,1);jsPlumb.Anchors.LeftMiddle=a(0,0.5,-1,0);jsPlumb.Anchors.RightMiddle=a(1,0.5,1,0);jsPlumb.Anchors.Center=a(0.5,0.5,0,0);jsPlumb.Anchors.TopRight=a(1,0,0,-1);jsPlumb.Anchors.BottomRight=a(1,1,0,1);jsPlumb.Anchors.TopLeft=a(0,0,0,-1);jsPlumb.Anchors.BottomLeft=a(0,1,0,1);jsPlumb.Defaults.DynamicAnchors=function(){return jsPlumb.makeAnchors(["TopCenter","RightMiddle","BottomCenter","LeftMiddle"])};jsPlumb.Anchors.AutoDefault=function(){return jsPlumb.makeDynamicAnchor(jsPlumb.Defaults.DynamicAnchors())};jsPlumb.Connectors.Straight=function(){var q=this;var k=null;var e,l,o,n,m,f,p,h,g,d,c;this.compute=function(u,I,E,r,B,t){var H=Math.abs(u[0]-I[0]);var A=Math.abs(u[1]-I[1]);var C=false,v=false;var z=0.45*H,s=0.45*A;H*=1.9;A*=1.9;var F=Math.min(u[0],I[0])-z;var D=Math.min(u[1],I[1])-s;var G=Math.max(2*B,t);if(H<G){H=G;F=u[0]+((I[0]-u[0])/2)-(G/2);z=(H-Math.abs(u[0]-I[0]))/2}if(A<G){A=G;D=u[1]+((I[1]-u[1])/2)-(G/2);s=(A-Math.abs(u[1]-I[1]))/2}h=u[0]<I[0]?z:H-z;g=u[1]<I[1]?s:A-s;d=u[0]<I[0]?H-z:z;c=u[1]<I[1]?A-s:s;k=[F,D,H,A,h,g,d,c];n=d-h,m=(c-g);e=m/n,l=-1/e;o=-1*((e*h)-g);f=Math.atan(e);p=Math.atan(l);return k};this.paint=function(s,r){r.beginPath();r.moveTo(s[4],s[5]);r.lineTo(s[6],s[7]);r.stroke()};this.pointOnPath=function(r){var s=h+(r*n);var t=(e==Infinity||e==-Infinity)?g+(r*(c-g)):(e*s)+o;return{x:s,y:t}};this.gradientAtPoint=function(r){return e};this.pointAlongPathFrom=function(s,w){var u=q.pointOnPath(s);var t=w>0?1:-1;var v=Math.abs(w*Math.sin(f));if(g>c){v=v*-1}var r=Math.abs(w*Math.cos(f));if(h>d){r=r*-1}return{x:u.x+(t*r),y:u.y+(t*v)}};this.perpendicularToPathAt=function(u,v,A){var w=q.pointAlongPathFrom(u,A);var t=q.gradientAtPoint(w.location);var s=Math.atan(-1/t);var z=v/2*Math.sin(s);var r=v/2*Math.cos(s);return[{x:w.x+r,y:w.y+z},{x:w.x-r,y:w.y-z}]};this.createGradient=function(s,r){return r.createLinearGradient(s[4],s[5],s[6],s[7])}};jsPlumb.Connectors.Bezier=function(c){var r=this;this.majorAnchor=c||150;this.minorAnchor=10;var l=null;this._findControlPoint=function(B,s,w,z,t){var y=z.getOrientation(),A=t.getOrientation();var v=y[0]!=A[0]||y[1]==A[1];var u=[];var C=r.majorAnchor,x=r.minorAnchor;if(!v){if(y[0]==0){u.push(s[0]<w[0]?B[0]+x:B[0]-x)}else{u.push(B[0]-(C*y[0]))}if(y[1]==0){u.push(s[1]<w[1]?B[1]+x:B[1]-x)}else{u.push(B[1]+(C*A[1]))}}else{if(A[0]==0){u.push(w[0]<s[0]?B[0]+x:B[0]-x)}else{u.push(B[0]+(C*A[0]))}if(A[1]==0){u.push(w[1]<s[1]?B[1]+x:B[1]-x)}else{u.push(B[1]+(C*y[1]))}}return u};var q,p,m,e,d,m,h,g,f,o,k;this.compute=function(M,v,K,t,s,G){s=s||0;o=Math.abs(M[0]-v[0])+s;k=Math.abs(M[1]-v[1])+s;g=Math.min(M[0],v[0])-(s/2);f=Math.min(M[1],v[1])-(s/2);m=M[0]<v[0]?o-(s/2):(s/2);h=M[1]<v[1]?k-(s/2):(s/2);e=M[0]<v[0]?(s/2):o-(s/2);d=M[1]<v[1]?(s/2):k-(s/2);q=r._findControlPoint([m,h],M,v,K,t);p=r._findControlPoint([e,d],v,M,t,K);var F=Math.min(m,e);var E=Math.min(q[0],p[0]);var A=Math.min(F,E);var L=Math.max(m,e);var I=Math.max(q[0],p[0]);var x=Math.max(L,I);if(x>o){o=x}if(A<0){g+=A;var B=Math.abs(A);o+=B;q[0]+=B;m+=B;e+=B;p[0]+=B}var J=Math.min(h,d);var H=Math.min(q[1],p[1]);var w=Math.min(J,H);var C=Math.max(h,d);var z=Math.max(q[1],p[1]);var u=Math.max(C,z);if(u>k){k=u}if(w<0){f+=w;var y=Math.abs(w);k+=y;q[1]+=y;h+=y;d+=y;p[1]+=y}if(G&&o<G){var D=(G-o)/2;o=G;g-=D;m=m+D;e=e+D;q[0]=q[0]+D;p[0]=p[0]+D}if(G&&k<G){var D=(G-k)/2;k=G;f-=D;h=h+D;d=d+D;q[1]=q[1]+D;p[1]=p[1]+D}l=[g,f,o,k,m,h,e,d,q[0],q[1],p[0],p[1]];return l};this.paint=function(t,s){s.beginPath();s.moveTo(t[4],t[5]);s.bezierCurveTo(t[8],t[9],t[10],t[11],t[6],t[7]);s.stroke()};var n=function(){return[{x:m,y:h},{x:q[0],y:q[1]},{x:p[0],y:p[1]},{x:e,y:d}]};this.pointOnPath=function(s){return jsBezier.pointOnCurve(n(),s)};this.gradientAtPoint=function(s){return jsBezier.gradientAtPoint(n(),s)};this.pointAlongPathFrom=function(s,t){return jsBezier.pointAlongCurveFrom(n(),s,t)};this.perpendicularToPathAt=function(s,t,u){return jsBezier.perpendicularToCurveAt(n(),s,t,u)};this.createGradient=function(u,s,t){return(t)?s.createLinearGradient(u[4],u[5],u[6],u[7]):s.createLinearGradient(u[6],u[7],u[4],u[5])}};jsPlumb.Endpoints.Dot=function(h){h=h||{radius:10};var f=this;this.radius=h.radius;var g=0.5*this.radius;var d=this.radius/3;var e=function(k){try{return parseInt(k)}catch(l){if(k.substring(k.length-1)=="%"){return parseInt(k.substring(0,k-1))}}};var c=function(m){var k=g;var l=d;if(m.offset){k=e(m.offset)}if(m.innerRadius){l=e(m.innerRadius)}return[k,l]};this.paint=function(z,m,o,n,q){var u=n.radius||f.radius;var w=z[0]-u;var v=z[1]-u;jsPlumb.sizeCanvas(o,w,v,u*2,u*2);var A=o.getContext("2d");var l=jsPlumb.extend({},n);if(l.fillStyle==null){l.fillStyle=q.strokeStyle}jsPlumb.extend(A,l);if(n.gradient&&!b){var p=c(n.gradient);var s=m[1]==1?p[0]*-1:p[0];var k=m[0]==1?p[0]*-1:p[0];var t=A.createRadialGradient(u,u,u,u+k,u+s,p[1]);for(var r=0;r<n.gradient.stops.length;r++){t.addColorStop(n.gradient.stops[r][0],n.gradient.stops[r][1])}A.fillStyle=t}A.beginPath();A.arc(u,u,u,0,Math.PI*2,true);A.closePath();A.fill()}};jsPlumb.Endpoints.Rectangle=function(d){d=d||{width:20,height:20};var c=this;this.width=d.width;this.height=d.height;this.paint=function(e,l,k,n,p){var s=n.width||c.width;var q=n.height||c.height;var o=e[0]-(s/2);var m=e[1]-(q/2);jsPlumb.sizeCanvas(k,o,m,s,q);var t=k.getContext("2d");var v=jsPlumb.extend({},n);if(v.fillStyle==null){v.fillStyle=p.strokeStyle}jsPlumb.extend(t,v);var r=(/MSIE/.test(navigator.userAgent)&&!window.opera);if(n.gradient&&!r){var h=l[1]==1?q:l[1]==0?q/2:0;var f=l[1]==-1?q:l[1]==0?q/2:0;var A=l[0]==1?s:l[0]==0?s/2:0;var w=l[0]==-1?s:l[0]==0?q/2:0;var z=t.createLinearGradient(A,h,w,f);for(var u=0;u<n.gradient.stops.length;u++){z.addColorStop(n.gradient.stops[u][0],n.gradient.stops[u][1])}t.fillStyle=z}t.beginPath();t.rect(0,0,s,q);t.closePath();t.fill()}};jsPlumb.Endpoints.Triangle=function(d){d=d||{width:55,height:55};var c=this;this.width=d.width;this.height=d.height;this.paint=function(q,f,h,g,l){var e=g.width||c.width;var r=g.height||c.height;var p=q[0]-e/2;var o=q[1]-r/2;jsPlumb.sizeCanvas(h,p,o,e,r);var s=h.getContext("2d");var n=0,m=0,k=0;if(f[0]==1){n=e;m=r;k=180}if(f[1]==-1){n=e;k=90}if(f[1]==1){m=r;k=-90}s.fillStyle=g.fillStyle;s.translate(n,m);s.rotate(k*Math.PI/180);s.beginPath();s.moveTo(0,0);s.lineTo(e/2,r/2);s.lineTo(0,r);s.closePath();s.fill()}};jsPlumb.Endpoints.Image=function(f){var c=this;this.img=new Image();var d=false;this.img.onload=function(){c.ready=true};this.img.src=f.src||f.url;var e=function(p,h,l,k,m){var g=c.img.width||k.width;var q=c.img.height||k.height;var o=p[0]-(g/2);var n=p[1]-(q/2);jsPlumb.sizeCanvas(l,o,n,g,q);var r=l.getContext("2d");r.drawImage(c.img,0,0)};this.paint=function(l,g,h,m,k){if(c.ready){e(l,g,h,m,k)}else{window.setTimeout(function(){c.paint(l,g,h,m,k)},200)}}};jsPlumb.Overlays.Arrow=function(h){h=h||{};var d=this;this.length=h.length||20;this.width=h.width||20;this.connection=h.connection;var g=(h.direction||1)<0?-1:1;var e=h.paintStyle||{lineWidth:1};this.loc=h.location==null?0.5:h.location;var c=h.foldback||0.623;var f=function(k,m){if(c==0.5){return k.pointOnPath(m)}else{var l=0.5-c;return k.pointAlongPathFrom(m,g*d.length*l)}};this.computeMaxSize=function(){return d.width*1.5};this.draw=function(m,z,y){var r=m.pointAlongPathFrom(d.loc,g*(d.length/2));var k=m.pointAlongPathFrom(d.loc,-1*g*(d.length/2)),o=k.x,n=k.y;var s=m.perpendicularToPathAt(d.loc,d.width,-1*g*(d.length/2));var q=f(m,d.loc);if(d.loc==1){var p=m.pointOnPath(d.loc);var A=p.x-r.x,x=p.y-r.y;q.x+=A;q.y+=x;k.x+=A;k.y+=x;s[0].x+=A;s[0].y+=x;s[1].x+=A;s[1].y+=x;r.x+=A;r.y+=x}if(d.loc==0){var p=m.pointOnPath(d.loc);var l=c>1?q:{x:s[0].x+((s[1].x-s[0].x)/2),y:s[0].y+((s[1].y-s[0].y)/2)};var A=p.x-l.x,x=p.y-l.y;q.x+=A;q.y+=x;k.x+=A;k.y+=x;s[0].x+=A;s[0].y+=x;s[1].x+=A;s[1].y+=x;r.x+=A;r.y+=x}var w=Math.min(r.x,s[0].x,s[1].x);var u=Math.max(r.x,s[0].x,s[1].x);var v=Math.min(r.y,s[0].y,s[1].y);var t=Math.max(r.y,s[0].y,s[1].y);z.lineWidth=e.lineWidth;z.beginPath();z.moveTo(r.x,r.y);z.lineTo(s[0].x,s[0].y);z.lineTo(q.x,q.y);z.lineTo(s[1].x,s[1].y);z.lineTo(r.x,r.y);z.closePath();if(e.strokeStyle){z.strokeStyle=e.strokeStyle;z.stroke()}z.fillStyle=e.fillStyle||y.strokeStyle;z.fill();return[w,u,v,t]}};jsPlumb.Overlays.PlainArrow=function(d){d=d||{};var c=jsPlumb.extend(d,{foldback:1});jsPlumb.Overlays.Arrow.call(this,c)};jsPlumb.Overlays.Diamond=function(e){e=e||{};var c=e.length||40;var d=jsPlumb.extend(e,{length:c/2,foldback:2});jsPlumb.Overlays.Arrow.call(this,d)};jsPlumb.Overlays.Label=function(l){this.labelStyle=l.labelStyle||jsPlumb.Defaults.LabelStyle;this.label=l.label;this.connection=l.connection;var d=this;var c=null,k=null,f=null,g=null;this.location=l.location||0.5;this.cachedDimensions=null;var h=function(n){if(d.cachedDimensions){return d.cachedDimensions}f=typeof d.label=="function"?d.label(d):d.label;var r={};if(f){var m=f.split(/\n|\r\n/);n.save();if(d.labelStyle.font){n.font=d.labelStyle.font}var o=e(m,n);var p=n.measureText("M").width;g=d.labelStyle.padding||0.25;c=o+(2*o*g);k=(m.length*p)+(2*p*g);var q=m.length*p;n.restore();r={width:c,height:k,lines:m,oneLine:p,padding:g,textHeight:q}}if(typeof d.label!="function"){d.cachedDimensions=r}return r};this.computeMaxSize=function(n,m){var o=h(m);return o.width?Math.max(o.width,o.height)*1.5:0};var e=function(o,n){var m=0;for(var q=0;q<o.length;q++){var p=n.measureText(o[q]).width;if(p>m){m=p}}return m};this.draw=function(p,o,q){var s=h(o);if(s.width){var r=p.pointOnPath(d.location);if(d.labelStyle.font){o.font=d.labelStyle.font}if(d.labelStyle.fillStyle){o.fillStyle=d.labelStyle.fillStyle}else{o.fillStyle="rgba(0,0,0,0)"}var n=r.x-(s.width/2);var m=r.y-(s.height/2);o.fillRect(n,m,s.width,s.height);if(d.labelStyle.color){o.fillStyle=d.labelStyle.color}o.textBaseline="middle";o.textAlign="center";for(i=0;i<s.lines.length;i++){o.fillText(s.lines[i],r.x,r.y-(s.textHeight/2)+(s.oneLine/2)+(i*s.oneLine))}if(d.labelStyle.borderWidth>0){o.strokeStyle=d.labelStyle.borderStyle||"black";o.strokeRect(n,m,s.width,s.height)}return[n,n+s.width,m,m+s.height]}else{return[0,0,0,0]}}};jsPlumb.Overlays.Image=function(e){var l=this;this.location=e.location||0.5;this.img=new Image();this.connection=e.connection;var m=null;var f=null;var d,c;var k=e.events||{};var h=function(){if(l.ready){window.clearInterval(f);m=document.createElement("img");m.src=l.img.src;m.style.position="absolute";m.style.display="none";m.className="_jsPlumb_overlay";document.body.appendChild(m);for(var n in k){jsPlumb.CurrentLibrary.bind(m,n,k[n])}if(d&&c){g(d,c);c=null;d=null}}};this.img.onload=function(){l.ready=true};this.img.src=e.src||e.url;f=window.setInterval(h,250);this.computeMaxSize=function(o,n){return[l.img.width,l.img.height]};var g=function(q,v,u){if(m!=null){var r=q.pointOnPath(l.location);var p=jsPlumb.CurrentLibrary.getElementObject(v.canvas);var w=jsPlumb.CurrentLibrary.getOffset(p);var t=r.x-(l.img.width/2);var s=r.y-(l.img.height/2);var n={left:w.left+t,top:w.top+s};jsPlumb.CurrentLibrary.setOffset(m,n);m.style.display="block";return[t,t+l.img.width,s,s+l.img.height]}};this.draw=function(o,n){if(l.ready){return g(o,n)}else{d=o;c=n;return[0,0,0,0]}}}})();(function(){jsPlumb.Connectors.Flowchart=function(f){f=f||{};var o=this,b=f.minStubLength||30,k=[],h=[],m=[],g=[],a=[],n=[],d,c,q=function(u,t,B,A){var y=0;for(var s=0;s<k.length;s++){var z=s==0?u:k[s][2],x=s==0?t:k[s][3],w=k[s][0],v=k[s][1];h[s]=z==w?Infinity:0;g[s]=Math.abs(z==w?v-x:w-z);y+=g[s]}var r=0;for(var s=0;s<k.length;s++){a[s]=g[s]/y;m[s]=[r,(r+=(g[s]/y))]}},p=function(){n.push(k.length);for(var r=0;r<k.length;r++){n.push(k[r][0]);n.push(k[r][1])}},e=function(s,A,z,w,t,r){var v=k.length==0?z:k[k.length-1][0];var u=k.length==0?w:k[k.length-1][1];k.push([s,A,v,u])},l=function(t){var r=m.length-1,s=0;for(var u=0;u<m.length;u++){if(m[u][1]>=t){r=u;s=(t-m[u][0])/a[u];break}}return{segment:k[r],proportion:s,index:r}};this.compute=function(u,J,F,r,C,s){k=[];h=[];a=[];g=[];segmentProportionals=[];d=J[0]<u[0];c=J[1]<u[1];var v=C||1,B=(v/2)+(b*2),A=(v/2)+(b*2),t=F.orientation||F.getOrientation(),I=r.orientation||r.getOrientation(),G=d?J[0]:u[0],E=c?J[1]:u[1],H=Math.abs(J[0]-u[0])+2*B,z=Math.abs(J[1]-u[1])+2*A;if(H<s){B+=(s-H)/2;H=s}if(z<s){A+=(s-z)/2;z=s}sx=d?H-B:B,sy=c?z-A:A,tx=d?B:H-B,ty=c?A:z-A,startStubX=sx+(t[0]*b),startStubY=sy+(t[1]*b),endStubX=tx+(I[0]*b),endStubY=ty+(I[1]*b),midx=startStubX+((endStubX-startStubX)/2),midy=startStubY+((endStubY-startStubY)/2);G-=B;E-=A;n=[G,E,H,z,sx,sy,tx,ty],extraPoints=[];e(startStubX,startStubY,sx,sy,tx,ty);if(t[0]==0){var D=startStubY<endStubY;if(D){e(startStubX,midy,sx,sy,tx,ty);e(midx,midy,sx,sy,tx,ty);e(endStubX,midy,sx,sy,tx,ty)}else{e(midx,startStubY,sx,sy,tx,ty);e(midx,endStubY,sx,sy,tx,ty)}}else{var D=startStubX<endStubX;if(D){e(midx,startStubY,sx,sy,tx,ty);e(midx,midy,sx,sy,tx,ty);e(midx,endStubY,sx,sy,tx,ty)}else{e(startStubX,midy,sx,sy,tx,ty);e(endStubX,midy,sx,sy,tx,ty)}}e(endStubX,endStubY,sx,sy,tx,ty);e(tx,ty,sx,sy,tx,ty);p();q(sx,sy,tx,ty);return n};this.paint=function(t,r){r.beginPath();r.moveTo(t[4],t[5]);for(var s=0;s<t[8];s++){r.lineTo(t[9+(s*2)],t[10+(s*2)])}r.lineTo(t[6],t[7]);r.stroke()};this.pointOnPath=function(r){return o.pointAlongPathFrom(r,0)};this.gradientAtPoint=function(r){return h[l(r)["index"]]};this.pointAlongPathFrom=function(v,z){var w=l(v),u=w.segment,y=w.proportion,t=g[w.index],r=h[w.index];var x={x:r==Infinity?u[2]:u[2]>u[0]?u[0]+((1-y)*t)-z:u[2]+(y*t)+z,y:r==0?u[3]:u[3]>u[1]?u[1]+((1-y)*t)-z:u[3]+(y*t)+z,segmentInfo:w};return x};this.perpendicularToPathAt=function(u,v,A){var w=o.pointAlongPathFrom(u,A);var t=h[w.segmentInfo.index];var s=Math.atan(-1/t);var z=v/2*Math.sin(s);var r=v/2*Math.cos(s);return[{x:w.x+r,y:w.y+z},{x:w.x-r,y:w.y-z}]}}})();(function(){var d=new Class({Extends:Fx.Morph,onStep:null,initialize:function(m,l){this.parent(m,l);if(l.onStep){this.onStep=l.onStep}},step:function(l){this.parent(l);if(this.onStep){try{this.onStep()}catch(m){}}}});var b={};var h={};var g={};var k={};var e=function(m,o,n){if(o){var p=o.get("id");if(p){var l=h[p];if(l){if(l[n]){l[n](m,o)}}}}};var f=function(m,o){if(m){var n=m.get("id");if(n){var l=h[n];if(l){if(l.hoverClass){if(o){m.addClass(l.hoverClass)}else{m.removeClass(l.hoverClass)}}}}}};var c=function(p,n,o){var m=p[n];if(!m){m=[];p[n]=m}m.push(o)};var a=function(l){return $(l)};jsPlumb.CurrentLibrary={addClass:function(m,l){m.addClass(l)},animate:function(p,o,n){var l=new d(p,n);l.start(o)},appendElement:function(m,l){a(l).grab(m)},bind:function(l,m,n){l=a(l);l.addEvent(m,n)},dragEvents:{start:"onStart",stop:"onComplete",drag:"onDrag",step:"onStep",over:"onEnter",out:"onLeave",drop:"onDrop",complete:"onComplete"},extend:function(m,l){return $extend(m,l)},getAttribute:function(l,m){return l.get(m)},getDragObject:function(l){return l[0]},getDragScope:function(m){var n=jsPlumb.getId(m);var l=k[n];return l[0].scope},getElementObject:a,getOffset:function(l){var m=l.getPosition();return{left:m.x,top:m.y}},getPageXY:function(l){return[l.event.pageX,l.event.pageY]},getScrollLeft:function(l){return null},getScrollTop:function(l){return null},getSize:function(m){var l=m.getSize();return[l.x,l.y]},getUIPosition:function(l){var m=l[0];return{left:m.offsetLeft,top:m.offsetTop}},hasClass:function(m,l){return m.hasClass(l)},initDraggable:function(m,u){var l=jsPlumb.getId(m);var p=k[l];if(!p){var n=0,o=null;var r=jsPlumb.Defaults.DragOptions.zIndex||2000;u.onStart=jsPlumb.wrap(u.onStart,function(){n=this.element.getStyle("z-index");this.element.setStyle("z-index",r);if(jsPlumb.Defaults.DragOptions.cursor){o=this.element.getStyle("cursor");this.element.setStyle("cursor",jsPlumb.Defaults.DragOptions.cursor)}});u.onComplete=jsPlumb.wrap(u.onComplete,function(){this.element.setStyle("z-index",n);if(o){this.element.setStyle("cursor",o)}});var t=u.scope||jsPlumb.Defaults.Scope;var q=function(v){return v.get("id")!=m.get("id")};var s=b[t]?b[t].filter(q):[];u.droppables=s;u.onLeave=jsPlumb.wrap(u.onLeave,function(v,w){if(w){f(w,false);e(v,w,"onLeave")}});u.onEnter=jsPlumb.wrap(u.onEnter,function(v,w){if(w){f(w,true);e(v,w,"onEnter")}});u.onDrop=function(v,w){if(w){f(w,false);e(v,w,"onDrop")}};p=new Drag.Move(m,u);p.scope=t;c(g,t,p);c(k,m.get("id"),p);if(u.disabled){p.detach()}}return p},initDroppable:function(p,m){var o=m.scope||jsPlumb.Defaults.Scope;c(b,o,p);var r=jsPlumb.getId(p);h[r]=m;var q=function(s){return s.element!=p};var l=g[o]?g[o].filter(q):[];for(var n=0;n<l.length;n++){l[n].droppables.push(p)}},isAlreadyDraggable:function(l){return k[jsPlumb.getId(l)]!=null},isDragSupported:function(m,l){return typeof Drag!="undefined"},isDropSupported:function(m,l){return(typeof Drag!=undefined&&typeof Drag.Move!=undefined)},removeClass:function(m,l){m.removeClass(l)},removeElement:function(l,m){a(l).dispose()},setAttribute:function(m,n,l){m.set(n,l)},setDraggable:function(n,m){var l=k[n.get("id")];if(l){l.each(function(o){if(m){o.attach()}else{o.detach()}})}},setDragScope:function(o,n){var m=k[o.get("id")];var p=function(q){return q.get("id")!=o.get("id")};var l=b[n]?b[n].filter(p):[];m[0].droppables=l},setOffset:function(l,m){a(l).setPosition({x:m.left,y:m.top})}};jsPlumb.init()})();(function(){if(typeof Math.sgn=="undefined"){Math.sgn=function(m){return m==0?0:m>0?1:-1}}var b={subtract:function(n,m){return{x:n.x-m.x,y:n.y-m.y}},dotProduct:function(n,m){return n.x*m.x+n.y*m.y},square:function(m){return Math.sqrt(m.x*m.x+m.y*m.y)},scale:function(n,m){return{x:n.x*m,y:n.y*m}}},d=Math.pow(2,-65),h=function(y,x){for(var s=[],v=x.length-1,r=2*v-1,t=[],w=[],o=[],p=[],q=[[1,0.6,0.3,0.1],[0.4,0.6,0.6,0.4],[0.1,0.3,0.6,1]],u=0;u<=v;u++){t[u]=b.subtract(x[u],y)}for(u=0;u<=v-1;u++){w[u]=b.subtract(x[u+1],x[u]);w[u]=b.scale(w[u],3)}for(u=0;u<=v-1;u++){for(var n=0;n<=v;n++){o[u]||(o[u]=[]);o[u][n]=b.dotProduct(w[u],t[n])}}for(u=0;u<=r;u++){p[u]||(p[u]=[]);p[u].y=0;p[u].x=parseFloat(u)/r}r=v-1;for(t=0;t<=v+r;t++){w=Math.min(t,v);for(u=Math.max(0,t-r);u<=w;u++){j=t-u;p[u+j].y+=o[j][u]*q[j][u]}}v=x.length-1;p=l(p,2*v-1,s,0);r=b.subtract(y,x[0]);o=b.square(r);for(u=q=0;u<p;u++){r=b.subtract(y,k(x,v,s[u],null,null));r=b.square(r);if(r<o){o=r;q=s[u]}}r=b.subtract(y,x[v]);r=b.square(r);if(r<o){o=r;q=1}return{location:q,distance:o}},l=function(E,D,y,B){var x=[],z=[],C=[],u=[],v=0,w,A;A=Math.sgn(E[0].y);for(var t=1;t<=D;t++){w=Math.sgn(E[t].y);w!=A&&v++;A=w}switch(v){case 0:return 0;case 1:if(B>=64){y[0]=(E[0].x+E[D].x)/2;return 1}var s,r,p;v=E[0].y-E[D].y;w=E[D].x-E[0].x;A=E[0].x*E[D].y-E[D].x*E[0].y;t=max_distance_below=0;for(r=1;r<D;r++){p=v*E[r].x+w*E[r].y+A;if(p>t){t=p}else{if(p<max_distance_below){max_distance_below=p}}}s=v;r=w;p=A-t;s=0*r-s*1;s=1/s;t=(1*p-r*0)*s;s=v;r=w;p=A-max_distance_below;s=0*r-s*1;s=1/s;v=(1*p-r*0)*s;if(Math.max(t,v)-Math.min(t,v)<d?1:0){C=E[D].x-E[0].x;u=E[D].y-E[0].y;y[0]=0+1*(C*(E[0].y-0)-u*(E[0].x-0))*(1/(C*0-u*1));return 1}}k(E,D,0.5,x,z);E=l(x,D,C,B+1);D=l(z,D,u,B+1);for(B=0;B<E;B++){y[B]=C[B]}for(B=0;B<D;B++){y[B+E]=u[B]}return E+D},k=function(n,m,p,r,o){for(var q=[[]],s=0;s<=m;s++){q[0][s]=n[s]}for(n=1;n<=m;n++){for(s=0;s<=m-n;s++){q[n]||(q[n]=[]);q[n][s]||(q[n][s]={});q[n][s].x=(1-p)*q[n-1][s].x+p*q[n-1][s+1].x;q[n][s].y=(1-p)*q[n-1][s].y+p*q[n-1][s+1].y}}if(r!=null){for(s=0;s<=m;s++){r[s]=q[s][0]}}if(o!=null){for(s=0;s<=m;s++){o[s]=q[m-s][s]}}return q[m][0]},g={},c=function(u){var t=g[u];if(!t){t=[];var p=function(v){return function(){return v}},r=function(){return function(v){return v}},o=function(){return function(v){return 1-v}},q=function(v){return function(x){for(var w=1,y=0;y<v.length;y++){w*=v[y](x)}return w}};t.push(new function(){return function(v){return Math.pow(v,u)}});for(var s=1;s<u;s++){for(var m=[new p(u)],n=0;n<u-s;n++){m.push(new r)}for(n=0;n<s;n++){m.push(new o)}t.push(new q(m))}t.push(new function(){return function(v){return Math.pow(1-v,u)}});g[u]=t}return t},a=function(n,m){for(var p=c(n.length-1),r=0,o=0,q=0;q<n.length;q++){r+=n[q].x*p[q](m);o+=n[q].y*p[q](m)}return{x:r,y:o}},f=function(n,m,p){var r=a(n,m),o=0;m=m;for(var q=p>0?1:-1,s=null;o<Math.abs(p);){m+=0.005*q;s=a(n,m);o+=Math.sqrt(Math.pow(s.x-r.x,2)+Math.pow(s.y-r.y,2));r=s}return{point:s,location:m}},e=function(n,m){var o=a(n,m),p=a(n.slice(0,n.length-1),m);return Math.atan((p.y-o.y)/(p.x-o.x))};window.jsBezier={distanceFromCurve:h,gradientAtPoint:e,nearestPointOnCurve:function(n,m){var o=h(n,m);return{point:k(m,m.length-1,o.location,null,null),location:o.location}},pointOnCurve:a,pointAlongCurveFrom:function(n,m,o){return f(n,m,o).point},perpendicularToCurveAt:function(n,m,o,p){p=p==null?0:p;m=f(n,m,p);n=e(n,m.location);p=Math.atan(-1/n);n=o/2*Math.sin(p);o=o/2*Math.cos(p);return[{x:m.point.x+o,y:m.point.y+n},{x:m.point.x-o,y:m.point.y-n}]}}})();