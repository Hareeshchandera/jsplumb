<!doctype html>
<html>
	<head>
		<title>multiple jsPlumb instances demonstration</title>
		<style type="text/css">
body { font-family: Gill, Verdana, sans; }
.blip { z-index:4;cursor:pointer; }
.blip1 { width:1em; height:1em; border:1px solid blue; background-color:yellow; }
.blip2 { width:0.5em; height:0.5em; border:1px dotted red; background-color:gray; }
.blip3 { width:1.5em; height:0.7em; background-color:#0e66a4; border:0.01em dotted #ddd; }
#info { height:2em;}
#container { position:relative; float:left;width:20em;}
#container2 { position:relative; margin-left:20em; width:30em; float:left;}
#container3 { position:relative; margin-left:40em; width:30em; float:left;}
button { margin-top:25em;z-index:20;position:absolute;}
.redo { left:11em;}
.clear { left:4em; }
_jsPlumb_connector { z-index:1; }		
		</style>
	</head>
	<body>
		<div id="info">Each 5x5 square is an independent jsPlumb instance, with separate clear and redraw buttons.</div>
		<div id="container"><button class="clear" rel="1">clear these</button><button class="redo" rel="1">redraw these</button></div>
		<div id="container2"><button class="clear" rel="2">clear these</button><button class="redo" rel="2">redraw these</button></div>
		<div id="container3"><button class="clear" rel="3">clear these</button><button class="redo" rel="3">redraw these</button></div>
	
		<script type="text/javascript" src="http://explorercanvas.googlecode.com/svn/trunk/excanvas.js"></script>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.0/jquery-ui.min.js"></script>
		<script type="text/javascript" src="../../js/1.2.1/jsPlumb-1.2.1-RC1.js"></script>
		<script type="text/javascript" src="../../js/1.2.1/jsPlumb-defaults-1.2.1-RC1.js"></script>
		<script type="text/javascript" src="../../js/1.2.1/jquery.jsPlumb-1.2.1-RC1.js"></script>		
		<script type="text/javascript">
			$(document).ready(function() {

// ********************* jsPlumb instances ******************************************				
				
				var jsPlumb1 = jsPlumb.getInstance();								
				var color = '#550';
				// note here we set defaults on this instance, not the static jsPlumb instance.
				jsPlumb1.Defaults.PaintStyle = { lineWidth:1, strokeStyle:color};
				jsPlumb1.Defaults.Connector = new jsPlumb.Connectors.Straight();
				jsPlumb1.Defaults.Endpoint = new jsPlumb.Endpoints.Dot({radius:3});
				jsPlumb.Defaults.EndpointStyle = { fillStyle: color };
				jsPlumb1.Defaults.Anchors = [ jsPlumb.Anchors.Center, jsPlumb.Anchors.Center ];

				var color2='rgba(31, 46, 61, 0.3)';
				// in this example we pass the defaults in to the jsPlumb instance.
				var jsPlumb2 = jsPlumb.getInstance({
					PaintStyle:{lineWidth:5, strokeStyle:color2},
					Connector:new jsPlumb.Connectors.Bezier(),
					Endpoint:new jsPlumb.Endpoints.Dot({radius:17}),
					EndpointStyle : { fillStyle: color2  },
					Anchor :  jsPlumb.Anchors.Center
				});

				var color3='green';
				// in this example we pass the defaults in to the jsPlumb instance.
				var jsPlumb3 = jsPlumb.getInstance({
					PaintStyle:{lineWidth:3, strokeStyle:color3},
					Connector:new jsPlumb.Connectors.Bezier(30),
					Endpoint:new jsPlumb.Endpoints.Dot({radius:5}),
					EndpointStyle : { fillStyle: color3  },
					Anchor :  jsPlumb.makeAnchor(0.5,0.5,1,1)
				});				

// *************************** blips to draw, drawing functions etc *****************************

				var blipWidth = 1, blipHeight = 1;
				var blipX = 5, blipY = 5;
				var spacer = 3.9;
				
				var getId = function(x, y, prefix) { return 'blip_' + (prefix ? prefix : '') + x + '_' + y; };
				var getLeft = function(x) { return (blipWidth + (x * (blipWidth * spacer))) + 'em'; };
				var getTop = function(y) { return (blipHeight + (y * (blipHeight * spacer))) + 'em'; };
				var getOthers = function(x, y, prefix) {
					var others = [];
					if (x > 0) others.push(getId(x-1, y, prefix));
					if (x < blipX - 1) others.push(getId(x + 1, y, prefix));					
					if (y > 0) others.push(getId(x, y-1, prefix));
					if (x > 0 && y > 0) others.push(getId(x-1, y-1, prefix));
					if (x < blipX - 1 && y > 0) others.push(getId(x+1, y-1, prefix));
					return others;
				}				

				var createBlips = function(elId, blipClass, prefix) {
					var container = document.getElementById(elId);
					for (var i = 0; i < blipX; i++) {
						for (var j = 0; j < blipY; j++) {
							var b = document.createElement("div");
							b.className = 'blip ' + blipClass;
							container.appendChild(b);
							$(b).attr('id', getId(i, j, prefix));
							$(b).css('position', 'absolute');
							$(b).css('left', getLeft(i));
							$(b).css('top', getLeft(j));
						}
					}
				};

				createBlips('container', "blip1");
				createBlips('container2', "blip2", '2_');
				createBlips('container3', "blip3", '3_');				

// ********************** plumbing code *************************************************

				var connectFunction = function(source, target, jsPlumbInstance) {
					jsPlumbInstance.connect( {source:source, target:target });
				};
				
				var draw = function(jsPlumbInstance, prefix) {					
					for (var i = 0; i < blipX; i++) {
						for (var j = 0; j < blipY; j++) {
							var others = getOthers(i, j, prefix);
							var id = getId(i, j, prefix);
							for (var k = 0 ; k < others.length; k++) {
								connectFunction(id, others[k], jsPlumbInstance);							
							}
						}
					}
				};

				draw(jsPlumb1);
				draw(jsPlumb2,'2_');
				draw(jsPlumb3,'3_');

// *********************** button setup ******************************************
				
				var jsPlumbs = {'1':jsPlumb1,  '2':jsPlumb2, '3':jsPlumb3};
				var prefixes = {'1':null,  '2':'2_', 3:'3_'};
				
				$(".clear").bind('click', function() {
					jsPlumbs[$(this).attr("rel")].detachEverything();
				});

				$(".redo").bind('click', function() {
					var j = $(this).attr("rel");
					draw(jsPlumbs[j], prefixes[j]);
				});				
			});
		</script>
	</body>

</html>