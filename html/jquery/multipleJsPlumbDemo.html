<!doctype html>
<html>
	<head>
		<title>multiple jsPlumb instances demonstration - jQuery</title>
		<style type="text/css">
body { font-family: Gill, Verdana, sans; }
.blip { z-index:4;cursor:pointer; }
.blip1 { width:1em; height:1em; border:1px solid blue; background-color:yellow; }
.blip2 { width:0.5em; height:0.5em; border:1px dotted red; background-color:gray; }
.blip3 { width:1.5em; height:0.7em; background-color:#0e66a4; border:0.01em dotted #ddd; }
#info { height:4em;font-size:90%;}
button { margin-top:25em;z-index:20;position:absolute;}
.redo { left:11em;}
.clear { left:4em; }
_jsPlumb_connector { z-index:1; }
.container {
border:2px dashed #567;
height:25em;
width:20em;
float:left;
margin-left:3em;
position:relative;
margin-top:3em;
overflow:scroll;
cursor:move;
background-color:#eee0fe;
opacity:0.9;
}
.container:hover { border:2px dashed #500; background-color:#fff0fe; }
.atestdiv {
width:4em;height:4em; background-color:yellow;margin:2em;
}
		</style>
	</head>
	<body>
		<div id="info">
			What's happening?
			<ul>
				<li>Each rectangle contains a separate jsPlumb instance</li>
				<li>You can drag each rectangle around the screen independently</li>
				<li>This demo uses jsPlumb 1.2.4, jQuery 1.4.2, and jQuery UI 1.8.0.</li>
			</ul>
		</div>
		<div id="container" class="container"><button disabled class="clear" rel="1">clear these</button><button disabled class="redo" rel="1">redraw these</button><!-- button class="anim" rel="1">animate these</button--></div>
		<div id="container2" class="container"><button disabled class="clear" rel="2">clear these</button><button disabled class="redo" rel="2">redraw these</button><!-- button class="anim" rel="2">animate these</button--></div>
		<div id="container3" class="container"><button disabled class="clear" rel="3">clear these</button><button disabled class="redo" rel="3">redraw these</button><!-- button class="anim" rel="3">animate these</button--></div>
		<div id="container4" class="container">
			<div id="c41" class="atestdiv"></div>
			<div id="c42" class="atestdiv"></div>
		</div>

		<script type="text/javascript" src="http://explorercanvas.googlecode.com/svn/trunk/excanvas.js"></script>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.0/jquery-ui.min.js"></script>
		<script type="text/javascript" src="../../js/1.2.4/jsPlumb-1.2.4-RC1.js"></script>
		<script type="text/javascript" src="../../js/1.2.4/jsPlumb-defaults-1.2.4-RC1.js"></script>
		<script type="text/javascript" src="../../js/1.2.4/jquery.jsPlumb-1.2.4-RC1.js"></script>
		<script type="text/javascript" src="../../js/1.2.4/jsBezier-0.1.js"></script>

		<script type="text/javascript">
			$(document).ready(function() {

				// chrome fix.
				document.onselectstart = function () { return false; };

// ********************* jsPlumb instances ******************************************

				var jsPlumb1 = jsPlumb.getInstance();
				var color = '#550';
				// note here we set defaults on this instance, not the static jsPlumb instance.
				jsPlumb1.Defaults.PaintStyle = { lineWidth:1, strokeStyle:color};
				jsPlumb1.Defaults.Connector = new jsPlumb.Connectors.Straight();
				jsPlumb1.Defaults.Endpoint = new jsPlumb.Endpoints.Dot({radius:3});
				jsPlumb.Defaults.EndpointStyle = { fillStyle: color };
				jsPlumb1.Defaults.Anchors = [ "Center", "Center" ];
				jsPlumb1.Defaults.Container = 'container';

				var color2='rgba(31, 46, 61, 0.3)';
				// in this example we pass the defaults in to the jsPlumb instance.
				var jsPlumb2 = jsPlumb.getInstance({
					PaintStyle:{lineWidth:5, strokeStyle:color2},
					Connector:new jsPlumb.Connectors.Bezier(),
					Endpoint:new jsPlumb.Endpoints.Dot({radius:17}),
					EndpointStyle : { fillStyle: color2  },
					Anchor :  "Center",
					Container : 'container2'
				});

				var color3='green';
				// in this example we pass the defaults in to the jsPlumb instance.
				var jsPlumb3 = jsPlumb.getInstance({
					PaintStyle:{lineWidth:3, strokeStyle:color3},
					Connector:new jsPlumb.Connectors.Bezier(30),
					Endpoint:new jsPlumb.Endpoints.Dot({radius:5}),
					EndpointStyle : { fillStyle: color3  },
					Anchor :  [0.5,0.5,1,1],
					Container : 'container3'
				});

// *************************** blips to draw, drawing functions etc *****************************

				var startX = 4.5, startY = 3;
				var blipWidth = 1, blipHeight = 1;
				var blipX = 3, blipY = 3;
				var spacer = 3.9;

				var getId = function(x, y, prefix) { return 'blip_' + (prefix ? prefix : '') + x + '_' + y; };
				var getLeft = function(x) { return startX + (blipWidth + (x * (blipWidth * spacer))) + 'em'; };
				var getTop = function(y) { return startY + (blipHeight + (y * (blipHeight * spacer))) + 'em'; };
				var getOthers = function(x, y, prefix) {
					var others = [];
					if (x > 0) others.push(getId(x-1, y, prefix));
					if (x < blipX - 1) others.push(getId(x + 1, y, prefix));
					if (y > 0) others.push(getId(x, y-1, prefix));
					if (x > 0 && y > 0) others.push(getId(x-1, y-1, prefix));
					if (x < blipX - 1 && y > 0) others.push(getId(x+1, y-1, prefix));
					return others;
				}

				var createBlips = function(elId, blipClass, prefix) {
					var container = document.getElementById(elId);
					for (var i = 0; i < blipX; i++) {
						for (var j = 0; j < blipY; j++) {
							var b = document.createElement("div");
							b.className = 'blip ' + blipClass;
							container.appendChild(b);
							$(b).attr('id', getId(i, j, prefix));
							$(b).css('position', 'absolute');
							$(b).css('left', getLeft(i));
							$(b).css('top', getTop(j));
						}
					}
				};

				createBlips('container', "blip1");
				createBlips('container2', "blip2", '2_');
				createBlips('container3', "blip3", '3_');

// ********************** plumbing code *************************************************

				var connectFunction = function(source, target, jsPlumbInstance) {
					jsPlumbInstance.connect( {source:source, target:target });
				};

				var draw = function(jsPlumbInstance, prefix) {
					for (var i = 0; i < blipX; i++) {
						for (var j = 0; j < blipY; j++) {
							var others = getOthers(i, j, prefix);
							var id = getId(i, j, prefix);
							for (var k = 0 ; k < others.length; k++) {
								connectFunction(id, others[k], jsPlumbInstance);
							}
						}
					}
				};

				draw(jsPlumb1);
				draw(jsPlumb2,'2_');
				draw(jsPlumb3,'3_');

// *********************** button setup ******************************************

				var jsPlumbs = {'1':jsPlumb1,  '2':jsPlumb2, '3':jsPlumb3};
				var prefixes = {'1':null,  '2':'2_', 3:'3_'};

				$(".clear").bind('click', function() {
					var j = $(this).attr("rel");
					jsPlumbs[j].detachEverything();
					$(".redo[rel=" + j + "]").attr('disabled',false);
				});

				$(".redo").bind('click', function() {
					var j = $(this).attr("rel");
					draw(jsPlumbs[j], prefixes[j]);
					$(this).attr('disabled',true);
				});

				$(".clear").attr('disabled',false);

				$(".container").draggable({zIndex:50});

// ** test code for overflow:scroll on parent element

			var eee = jsPlumb.addEndpoint("c41", {
				isTarget:true,
				isSource:true,
				scope:"test"
			});
			var eee2 = jsPlumb.addEndpoint("c42", {
				isTarget:true,
				isSource:true,
				scope:"test"
			});

			});
		</script>

		<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
			<input type="hidden" name="cmd" value="_s-xclick">
			<input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----">
			<input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donate_SM.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
			<img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1">
		</form>
	</body>
</html>