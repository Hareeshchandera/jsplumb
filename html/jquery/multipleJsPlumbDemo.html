<!doctype html>
<html>
	<head>
		<title>multiple jsPlumb instances demonstration - jQuery</title>
		<style type="text/css">
body { font-family: Gill, Verdana, sans; }
.blip { z-index:4;cursor:pointer; }
.blip1 { width:1em; height:1em; border:1px solid blue; background-color:yellow; }
.blip2 { width:0.5em; height:0.5em; border:1px dotted red; background-color:gray; }
.blip3 { width:1.5em; height:0.7em; background-color:#0e66a4; border:0.01em dotted #ddd; }
#info { height:4em;font-size:90%;}
button { margin-top:25em;z-index:20;position:absolute;}
.redo { left:11em;}
.clear { left:4em; }
_jsPlumb_connector { z-index:1; }
.container {
border:2px dashed #567;
height:25em;
width:20em;
float:left;
margin-left:3em;
position:relative;
margin-top:3em;
overflow:scroll;
cursor:move;
background-color:#eee0fe;
opacity:0.9;
}
.container:hover { border:2px dashed #500; background-color:#fff0fe; }
.atestdiv {
width:4em;height:4em; background-color:yellow;margin:2em;
}
		</style>
	</head>
	<body>
		<div id="info">
			What's happening?
			<ul>
				<li>Each rectangle contains a separate jsPlumb instance</li>
				<li>You can drag each rectangle around the screen independently</li>  
				<li>This demo uses jsPlumb 1.2.4, jQuery 1.4.2, and jQuery UI 1.8.0.</li>
			</ul>
		</div>
		<div id="container" class="container"><button disabled class="clear" rel="1">clear these</button><button disabled class="redo" rel="1">redraw these</button><!-- button class="anim" rel="1">animate these</button--></div>
		<div id="container2" class="container"><button disabled class="clear" rel="2">clear these</button><button disabled class="redo" rel="2">redraw these</button><!-- button class="anim" rel="2">animate these</button--></div>
		<div id="container3" class="container"><button disabled class="clear" rel="3">clear these</button><button disabled class="redo" rel="3">redraw these</button><!-- button class="anim" rel="3">animate these</button--></div>
		<div id="container4" class="container">
			<div id="c41" class="atestdiv"></div>
			<div id="c42" class="atestdiv"></div>
		</div>
	
		<script type="text/javascript" src="http://explorercanvas.googlecode.com/svn/trunk/excanvas.js"></script>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.0/jquery-ui.min.js"></script>
		<script type="text/javascript" src="http://localhost/programming/jsplumb-google-2/js/1.2.4/jsPlumb-1.2.4-RC1.js"></script>
		<script type="text/javascript" src="http://localhost/programming/jsplumb-google-2/js/1.2.4/jsPlumb-defaults-1.2.4-RC1.js"></script>
		<script type="text/javascript" src="http://localhost/programming/jsplumb-google-2/js/1.2.4/jquery.jsPlumb-1.2.4-RC1.js"></script>
		<script type="text/javascript" src="http://localhost/programming/jsplumb-google-2/js/1.2.4/jsBezier-0.1.js"></script>
								
		<script type="text/javascript">
			$(document).ready(function() {

				// chrome fix.
				document.onselectstart = function () { return false; };

// ********************* jsPlumb instances ******************************************				
				
				var jsPlumb1 = jsPlumb.getInstance();								
				var color = '#550';
				// note here we set defaults on this instance, not the static jsPlumb instance.
				jsPlumb1.Defaults.PaintStyle = { lineWidth:1, strokeStyle:color};
				jsPlumb1.Defaults.Connector = new jsPlumb.Connectors.Straight();
				jsPlumb1.Defaults.Endpoint = new jsPlumb.Endpoints.Dot({radius:3});
				jsPlumb.Defaults.EndpointStyle = { fillStyle: color };
				jsPlumb1.Defaults.Anchors = [ "Center", "Center" ];
				jsPlumb1.Defaults.Container = 'container';

				var color2='rgba(31, 46, 61, 0.3)';
				// in this example we pass the defaults in to the jsPlumb instance.
				var jsPlumb2 = jsPlumb.getInstance({
					PaintStyle:{lineWidth:5, strokeStyle:color2},
					Connector:new jsPlumb.Connectors.Bezier(),
					Endpoint:new jsPlumb.Endpoints.Dot({radius:17}),
					EndpointStyle : { fillStyle: color2  },
					Anchor :  "Center",
					Container : 'container2'
				});

				var color3='green';
				// in this example we pass the defaults in to the jsPlumb instance.
				var jsPlumb3 = jsPlumb.getInstance({
					PaintStyle:{lineWidth:3, strokeStyle:color3},
					Connector:new jsPlumb.Connectors.Bezier(30),
					Endpoint:new jsPlumb.Endpoints.Dot({radius:5}),
					EndpointStyle : { fillStyle: color3  },
					Anchor :  [0.5,0.5,1,1],
					Container : 'container3'
				});				

// *************************** blips to draw, drawing functions etc *****************************

				var startX = 4.5, startY = 3;
				var blipWidth = 1, blipHeight = 1;
				var blipX = 3, blipY = 3;
				var spacer = 3.9;
				
				var getId = function(x, y, prefix) { return 'blip_' + (prefix ? prefix : '') + x + '_' + y; };
				var getLeft = function(x) { return startX + (blipWidth + (x * (blipWidth * spacer))) + 'em'; };
				var getTop = function(y) { return startY + (blipHeight + (y * (blipHeight * spacer))) + 'em'; };
				var getOthers = function(x, y, prefix) {
					var others = [];
					if (x > 0) others.push(getId(x-1, y, prefix));
					if (x < blipX - 1) others.push(getId(x + 1, y, prefix));					
					if (y > 0) others.push(getId(x, y-1, prefix));
					if (x > 0 && y > 0) others.push(getId(x-1, y-1, prefix));
					if (x < blipX - 1 && y > 0) others.push(getId(x+1, y-1, prefix));
					return others;
				}				

				var createBlips = function(elId, blipClass, prefix) {
					var container = document.getElementById(elId);
					for (var i = 0; i < blipX; i++) {
						for (var j = 0; j < blipY; j++) {
							var b = document.createElement("div");
							b.className = 'blip ' + blipClass;
							container.appendChild(b);
							$(b).attr('id', getId(i, j, prefix));
							$(b).css('position', 'absolute');
							$(b).css('left', getLeft(i));
							$(b).css('top', getTop(j));
						}
					}
				};

				createBlips('container', "blip1");
				createBlips('container2', "blip2", '2_');
				createBlips('container3', "blip3", '3_');				

// ********************** plumbing code *************************************************

				var connectFunction = function(source, target, jsPlumbInstance) {
					jsPlumbInstance.connect( {source:source, target:target });
				};
				
				var draw = function(jsPlumbInstance, prefix) {					
					for (var i = 0; i < blipX; i++) {
						for (var j = 0; j < blipY; j++) {
							var others = getOthers(i, j, prefix);
							var id = getId(i, j, prefix);
							for (var k = 0 ; k < others.length; k++) {
								connectFunction(id, others[k], jsPlumbInstance);							
							}
						}
					}
				};

				draw(jsPlumb1);
				draw(jsPlumb2,'2_');
				draw(jsPlumb3,'3_');

// *********************** button setup ******************************************
				
				var jsPlumbs = {'1':jsPlumb1,  '2':jsPlumb2, '3':jsPlumb3};
				var prefixes = {'1':null,  '2':'2_', 3:'3_'};
				
				$(".clear").bind('click', function() {
					var j = $(this).attr("rel");
					jsPlumbs[j].detachEverything();
					$(".redo[rel=" + j + "]").attr('disabled',false);
				});

				$(".redo").bind('click', function() {
					var j = $(this).attr("rel");
					draw(jsPlumbs[j], prefixes[j]);
					$(this).attr('disabled',true);
				});

				$(".clear").attr('disabled',false);	

				$(".container").draggable({zIndex:50});

// ** test code for overflow:scroll on parent element

			var eee = jsPlumb.addEndpoint("c41", {
				isTarget:true,
				isSource:true,
				scope:"test"
			});
			var eee2 = jsPlumb.addEndpoint("c42", {
				isTarget:true,
				isSource:true,
				scope:"test"
			});			
				
			});
		</script>
		
		<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
			<input type="hidden" name="cmd" value="_s-xclick">
			<input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----">
			<input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
			<img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1">
		</form>
	</body>
</html>