<!doctype html>
<html>
	<head>
		<title>draggable connectors experiments</title>
		<meta http-equiv="X-UA-Compatible" content="IE=7">
		<script type="text/javascript" src="http://explorercanvas.googlecode.com/svn/trunk/excanvas.js"></script>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.0/jquery-ui.min.js"></script>
		
		<script type="text/javascript" src="../js/jquery.jsPlumb-1.1.0-RC1.js"></script>
		<!-- script type="text/javascript" src="../js/jquery.jsPlumb-flowchart-RC1.js"></script-->
		<script type="text/javascript" src="../js/jquery.jsPlumb-defaults-1.1.0-RC1.js"></script>
		
		<script type="text/javascript"><!--
			$(document).ready(function() {
				jsPlumb.DEFAULT_DRAG_OPTIONS = { cursor: 'pointer', zIndex:2000 };
				jsPlumb.DEFAULT_PAINT_STYLE = { strokeStyle:'#666' };
				jsPlumb.DEFAULT_ENDPOINT_STYLE = { width:20, height:16, strokeStyle:'#666' };
				jsPlumb.DEFAULT_ENDPOINT = new jsPlumb.Endpoints.Rectangle();
				jsPlumb.DEFAULT_ANCHORS = [jsPlumb.Anchors.TopCenter, jsPlumb.Anchors.TopCenter];

				var exampleGreyEndpoint = {
					endpoint:new jsPlumb.Endpoints.Rectangle(),
					anchor:jsPlumb.Anchors.TopCenter,
					style:{ width:25, height:21, fillStyle:'#666' },					
					isSource:true,
					dragOptions : { scope:'exampleGreyConnection' },
					connectionStyle : {
						strokeStyle:"#666"
					},
					isTarget:true,
					dropOptions : $.extend({scope:'exampleGreyConnection'}, exampleDropOptions)
				};

				//var w1grey = jsPlumb.addEndpoint("window1", exampleGreyEndpoint);
				//var w2grey = jsPlumb.addEndpoint("window2", exampleGreyEndpoint);
				
			//	$("#window1").plumb({target:'window2', sourceEndpoint:w1grey, targetEndpoint:w2grey});

				
				 // plumb a few things together to start with, using the defaults.
				//$("#window1").plumb({target:'window2'}); 
				/*$("#window1").plumb({target:'window3'});
				$("#window2").plumb({target:'window4'});
				$("#window2").plumb({target:'window5'});
				$("#window3").plumb({target:'window6'});*/

				// generic drop options to be used by all endpoints - they will extend and provide their own scope.
				// notice the 'drop' method which is commented out.  you might want to do your own thing in a drop method.
				// also note the 'activeClass' - a class applied to your droppable when a suitable draggable is hovering.  these
				// are both jquery UI droppable parameters: jsPlumb tries to be as transparent as possible with draggable and droppable,
				// only wrapping the methods it needs, and assuming to know nothing more than that.			
				var exampleDropOptions = { 					
					tolerance:'touch', 
					hoverClass:'dropHover'//,
					//drop : function(e, ui) { alert('dropped'); }
					//activeClass:'dragActive' 
				};
				
				/**
					first example endpoint.  it's a 25x21 rectangle (the size is provided in the 'style' arg to the Endpoint), and it's both a source
					and target.  the 'scope' of this Endpoint is 'exampleConnection', meaning any connection starting from this Endpoint is of type
					'exampleConnection' and can only be dropped on an Endpoint target that declares 'exampleEndpoint' as its drop scope, and also that
					only 'exampleConnection' types can be dropped here.

					the connection style for this endpoint is a Bezier curve (we didn't provide one, so we use the default), with a lineWidth of
					5 pixels, and a gradient.

					note the use of the '$.extend' function to setup generic connection types.  this will save you a lot of typing, and probably
					errors.							
									
				*/
				var exampleEndpoint = {
					endpoint:new jsPlumb.Endpoints.Rectangle(),
					style:{ width:25, height:21, fillStyle:'#00f' },					
					isSource:true,
					dragOptions : { scope:'exampleConnection' },
					connectionStyle : {
						gradient:{stops:[[0,'#00f'], [0.5, '#09098e'], [1,'#00f']]},
						lineWidth:5,
						strokeStyle:"#00f"
					},
					isTarget:true,
					dropOptions : $.extend({scope:'exampleConnection'}, exampleDropOptions)
				};

				/**
					the second example uses a Dot of radius 15 as the endpoint marker, is both a source and target, and has scope
					'exampleConnection2'.
				*/
				var exampleEndpoint2 = {
						endpoint:new jsPlumb.Endpoints.Dot({radius:15}),
						style:{ strokeStyle:'#316b31' }, 
						isSource:true,
						dragOptions : { scope:'exampleConnection2' },
						connectionStyle:{ strokeStyle:'#316b31', lineWidth:8 },
						isTarget:true, 
						dropOptions : $.extend({scope:'exampleConnection2'}, exampleDropOptions)
				};

				/**
				the third example uses a Dot of radius 17 as the endpoint marker, is both a source and target, and has scope
				'exampleConnection3'.  it uses a Straight connector, and the Anchor is created here (bottom left corner) and never
				overriden, so it appears in the same place on every element.

				this example also sets the 'reattach' flag for the Endpoint, meaning that when you drag a
				connection off an endpoint and release it, it snaps back.  the default behaviour in this case
				is to delete the connection.
				
				*/
				var example3Color = "rgba(229,219,61,0.5)";
				var exampleEndpoint3 = {
						endpoint:new jsPlumb.Endpoints.Dot({radius:17}),
						reattach:true,
						anchor:jsPlumb.Anchors.BottomLeft,
						style:{ strokeStyle:example3Color, opacity:0.5 }, 
						isSource:true,
						dragOptions : { scope:'exampleConnection3' },
						connectionStyle:{ strokeStyle:example3Color, lineWidth:4 },
						connector : new jsPlumb.Connectors.Straight(),
						isTarget:true, 						
						dropOptions : $.extend({scope:'exampleConnection3'}, exampleDropOptions)
				};			

				// setup some empty endpoints.  again note the use of '$.extend' to reuse all the parameters except the location
				// of the anchor (purely because we want to move the anchor around here; you could set it one time and forget about it though.)				

				$("#window1").addEndpoints([
					$.extend({ anchor:jsPlumb.makeAnchor(1, 0.25, 1, 0) }, exampleEndpoint),
					$.extend({ anchor:jsPlumb.makeAnchor(1, 0.75, 0, 1) }, exampleEndpoint),
					$.extend({ anchor:jsPlumb.makeAnchor(0.5, 1, 0, 1) }, exampleEndpoint2)
				]);

				$("#window2").addEndpoints([
					$.extend({ anchor:jsPlumb.makeAnchor(0.5, 1, 0, 1) }, exampleEndpoint),
					$.extend({ anchor:jsPlumb.Anchors.RightMiddle }, exampleEndpoint2)
				]);

				$("#window3").addEndpoints([
    				$.extend({ anchor:jsPlumb.makeAnchor(0.25, 0, 0, -1) }, exampleEndpoint),
    				$.extend({ anchor:jsPlumb.makeAnchor(0.75, 0, 0, -1) }, exampleEndpoint2)
     			]);

				$("#window4").addEndpoints([
					$.extend({ anchor:jsPlumb.makeAnchor(1, 0.5, 1, 0) }, exampleEndpoint),
					$.extend({ anchor:jsPlumb.makeAnchor(0.25, 0, 0, -1) }, exampleEndpoint2)
				]);
				
				$("#window5").addEndpoint($.extend({ anchor:jsPlumb.makeAnchor(0, 0.5, -1, 0) }, exampleEndpoint));

				$("#window6").addEndpoint($.extend({ anchor:jsPlumb.makeAnchor(0.25, 0.5, 0, -1) }, exampleEndpoint2));				

				// add the third example using the '.window' class.
				$(".window").addEndpoint(exampleEndpoint3);								
			});
		--></script>
		<link rel="stylesheet" href="/mp.css"></link>
		<link rel="stylesheet" href="../css/jsPlumbDemo.css"></link>
		<style type="text/css">
/* demo */

#window1 { top:6em;left:25em; }
#window2 { top:14em; left:21em;left:10em; }
#window3 { top:19em; left:40em; }
#window4 { left:4em;top:28em; }
#window5 { left:24em;top:29em; }
#window6 { left:52em;top:29em; }
.window { 
border:1px solid gray; width:14em; height:4em; z-index:20; position:absolute; color:gray;line-height:3em;font-family:serif;font-style:italic;
padding-top:0.9em; font-size:0.9em;text-align:center;z-index:40;background-color:white; 
}	

._jsPlumb_endpoint { z-index:50; }
	
.dropHover { border:1px dotted red; } 
.dragActive { border:1px solid blue; }

#explanation { width:26em; }		
		
		</style>
	</head>
	<body onunload="jsPlumb.unload();">
		<div class="menu"><a href="../doc/usage.html" class="mplink">view documentation</a>&nbsp;|&nbsp;<a href="mailto:simon.porritt@gmail.com" class="mplink">contact me</a>&nbsp;|&nbsp;<a href="http://code.google.com/p/jsplumb/" class="mplink">jsPlumb on Google code</a></div>
	
		<div class="window" id="window1">one</div>
		<div class="window" id="window2">two</div>
		<div class="window" id="window3">three</div>
		<div class="window" id="window4">four</div>
		<div class="window" id="window5">five</div>
		<div class="window" id="window6">six</div>

		<div id="explanation">
	    	This page is an early demonstration of the draggable/droppable functionality that is being added to jsPlumb.  
	    	A few windows are plumbed to start with, using the default settings, and there are empty Endpoints on each window, from which you 
	    	can drag new connectors between matching endpoints.  
	    	<p>
		    	<ul>
		    		<li>Once an Endpoint has a Connection attached, you cannot draw any more Connections from that Endpoint - you can
		    		only drag that Connection somewhere else.  This topic is an open question, really.  It would be simple to support both
		    		the current functionality as well as having the Endpoint always act as a Connection source (without the ability to move
		    		existing Connections).  The middle ground would require something a little more tricky - a way to select the Connection
		    		you wish to move.  This would probably involve some UI widget.<br/><br/></li>
		    		<li>There is not yet any support for removing an existing Connection (via the UI.  jsPlumb does offer methods to
		    		remove Connections in the API).  This, too, poses the question of how the user would trigger the deletion.  Should jsPlumb
		    		provide the full UI or just some event hooks?<br/><br/></li>
		    		<li>There may be other random bugs.  The script is not finalised.</li>	
		    	</ul>
	    	
	    	</p>
	    	<p>This demonstration uses version 1.1.0-RC1 of jsPlumb.  You should NOT use this script yet.  It's not at all guaranteed to be free
	    	of bugs.</p>
	    	<a href="demo.html" class="mplink">Home</a>
	    	<br/><br/>
	    	You also might like to check out <a  class="mplink" href="http://tweetplumb.com?q=#jquery" target="_blank">TweetPlumb</a>, a Twitter visualisation built with jsPlumb.
	    	
	    	<div id="debug"></div>
	    	<!-- button id="btnHideAll">Hide</button>
	    	<button id="btnShowAll">Show</button-->
	    	<!-- button id="btnDetachAll">Detach All</button-->
	    </div>
	    
	    <script type="text/javascript">
			/*$("#btnHideAll").click(function() { jsPlumb.hide("window2"); });
			$("#btnShowAll").click(function() { jsPlumb.show("window2"); });
			$("#btnDetachAll").click(function() { jsPlumb.detachEverything(); });*/

	    </script>
	    
	    	   	    <!-- Start of StatCounter Code -->
<script type="text/javascript">
var sc_project=5700644; 
var sc_invisible=1; 
var sc_partition=71; 
var sc_click_stat=1; 
var sc_security="1cb90164"; 
</script>

<script type="text/javascript"
src="http://www.statcounter.com/counter/counter.js"></script><noscript><div
class="statcounter"><a title="counter for wordpress"
href="http://www.statcounter.com/wordpress.org/"
target="_blank"><img class="statcounter"
src="http://c.statcounter.com/5700644/0/1cb90164/1/"
alt="counter for wordpress" ></a></div></noscript>
<!-- End of StatCounter Code -->
	</body>
</html>
